======================================================= 
BUNDLE COMPLET DU PROJET NEXT.JS                      
======================================================= 
Date: 31/12/2025 18:13:34,99                                      
Dossier: C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog                                 
Dossiers inclus: app, components, lib                  
======================================================= 
 
[SECTION 1] ARBORESCENCE DU PROJET                     
======================================================= 
 
DOSSIER: \app                                   
------------------------------------------------- 
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\api
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\favicon.ico
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\globals.css
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\layout.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\page.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\posts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\test-admin-simple.js
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\edit
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\new
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\page.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\users
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\[uid]
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\edit\[slug]
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\edit\[slug]\page.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\new\page.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\users\page.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\[uid]\role
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\admin\[uid]\role\route.ts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\api\admin
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\api\admin\users
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\api\admin\users\route.ts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\posts\[slug]
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\app\posts\[slug]\page.tsx
 
DOSSIER: \components                                   
------------------------------------------------- 
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\AdminPostsList.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\AllPosts.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\Footer.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\Header.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\LatestPost.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\LoginModal.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\PostCard.tsx
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\components\RichTextEditor.tsx
 
DOSSIER: \lib                                   
------------------------------------------------- 
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\firebase-admin.ts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\firebase.js
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\firestore-admin.ts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\firestore.ts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\supabaseClient.ts
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\temp.js
C:\Users\Lenovo\Documents\webdev\Mon-blog\mon-blog\lib\user-management.ts
 
======================================================= 
FIN DE L'ARBORESCENCE                                  
======================================================= 
 
 
[SECTION 2] CONTENU COMPLET DES FICHIERS               
======================================================= 
 
[SOUS-SECTION 2.1] FICHIERS DE CONFIGURATION RACINE    
------------------------------------------------------- 
 
[FICHIER 1] \package.json               
************************************************ 
{
  "name": "mon-blog",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@protobufjs/aspromise": "^1.1.2",
    "@supabase/supabase-js": "^2.86.0",
    "firebase": "^12.6.0",
    "firebase-admin": "^13.6.0",
    "next": "^16.0.8",
    "quill": "^2.0.3",
    "react": "19.2.0",
    "react-dom": "19.2.0",
    "react-icons": "^5.5.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv": "^17.2.3",
    "eslint": "^9",
    "eslint-config-next": "16.0.3",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
 
************************************************ 
 
[FICHIER 2] \next.config.ts               
************************************************ 
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Configuration pour le compilateur (Next.js 13+, pour Turbopack/SWC)
  compiler: {
    // Par exemple, d√©sactiver console.log en production
    // removeConsole: process.env.NODE_ENV === "production",
  },
  
  // Configuration pour le composant Image
  images: {
    // Liste des domaines externes autoris√©s
    remotePatterns: [
      {
        protocol: 'https',
        // Domaine ajout√© pr√©c√©demment
        hostname: 'storage.canalblog.com', 
        port: '',
        pathname: '/**',
      },
      {
        protocol: 'https',
        // NOUVEAU DOMAINE : images.pexels.com pour l'image qui cause l'erreur actuelle
        hostname: 'images.pexels.com', 
        port: '',
        pathname: '/**',
      },
      {
        protocol: 'https',
        // NOUVEAU DOMAINE : images.pexels.com pour l'image qui cause l'erreur actuelle
        hostname: 'res.cloudinary.com', 
        port: '',
        pathname: '/**',
      },
      // Ajoutez ici d'autres domaines externes si vous en utilisez 
    ],
  },
  
  // Si vous utilisez Turbopack, cette ligne peut √™tre n√©cessaire, sinon elle est ignor√©e
  // experimental: {
  //   serverActions: true,
  // },
};

module.exports = nextConfig; 
************************************************ 
 
[FICHIER 3] \tsconfig.json               
************************************************ 
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
 
************************************************ 
 
[SOUS-SECTION 2.2] FICHIERS DES DOSSIERS SPECIFIQUES   
------------------------------------------------------- 
 
[DOSSIER: \app]                                 
=============================================== 
 
[FICHIER 4] \app\globals.css 
------------------------------------------- 
@import "tailwindcss";

/* D√©sactive le dark mode forc√© de Chrome Android */
html {
  color-scheme: light dark;
}


:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}
 
------------------------------------------- 
 
[FICHIER 5] \app\layout.tsx 
------------------------------------------- 
// app/layout.tsx

import type { Metadata } from 'next';
import { Inter } from 'next/font/google'; // Importation de la police Inter
import './globals.css'; // Importe le CSS global
import Header from '@/components/Header';
import Footer from '@/components/Footer';
export const dynamic = "force-dynamic";

// Initialisation de la police
const inter = Inter({ subsets: ['latin'] });

// M√©tadonn√©es de l'application
export const metadata: Metadata = {
  title: 'Mon Blog Next.js & Firebase',
  description: 'Un blog construit pas √† pas avec Next.js, Tailwind, et Firebase.',
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  // Cette classe assure le fond sombre pour le <body> et corrige l'erreur d'hydratation.
  const bodyClasses = `${inter.className} bg-slate-900 text-gray-100 min-h-screen flex flex-col`;

  return (
    <html lang="fr">
      <body className={bodyClasses}>
        
        <Header />
        
        {/* CORRECTION: Ajout de bg-slate-900 √† l'√©l√©ment <main> pour garantir que le fond de la zone de contenu est sombre. */}
        <main className="flex-grow bg-slate-900"> 
          {children}
        </main>

        <Footer />
      </body>
    </html>
  );
} 
------------------------------------------- 
 
[FICHIER 6] \app\page.tsx 
------------------------------------------- 
import LatestPost from "@/components/LatestPost";
import AllPosts from "@/components/AllPosts";

export default function Home() {
  return (
    <div className="max-w-6xl mx-auto py-16 px-4">

      <header className="text-center mb-12">
        <h1 className="text-6xl font-extrabold text-white tracking-tight">
          Mon Blog Moto
        </h1>
        <p className="text-xl text-gray-400 mt-3">
          Le dernier article est charg√© dynamiquement ci-dessous.
        </p>
      </header>

      {/* Dernier article */}
      <section className="mt-10">
        <h2 className="text-4xl font-bold text-gray-200 mb-6 text-center">
          Dernier Article publi√©
        </h2>

        <LatestPost />
      </section>

      {/* Tous les articles */}
      <section className="mt-20">
        <h2 className="text-3xl font-bold text-gray-200 mb-6">
          Tous les articles
        </h2>

        <AllPosts />
      </section>

    </div>
  );
}
 
------------------------------------------- 
 
[FICHIER 7] \app\test-admin-simple.js 
------------------------------------------- 
// test-admin-simple-alternative.js
const path = require('path');
const fs = require('fs');

console.log('üöÄ Test Firebase Admin avec fichier JSON...');

// Chemin vers le fichier JSON
const serviceAccountPath = path.join(__dirname, '..', 'config', 'serviceAccountKey.json');

if (!fs.existsSync(serviceAccountPath)) {
  console.error(`‚ùå Fichier JSON non trouv√©: ${serviceAccountPath}`);
  process.exit(1);
}

try {
  // Lire le fichier JSON
  const serviceAccount = require(serviceAccountPath);
  console.log('‚úÖ Fichier JSON charg√©:');
  console.log(`   Project ID: ${serviceAccount.project_id}`);
  console.log(`   Client Email: ${serviceAccount.client_email}`);
  console.log(`   Private Key ID: ${serviceAccount.private_key_id}`);
  console.log(`   Private Key (d√©but): ${serviceAccount.private_key.substring(0, 30)}...`);
  
  // Initialiser Firebase Admin
  const admin = require('firebase-admin');
  
  if (admin.apps.length === 0) {
    admin.initializeApp({
      credential: admin.credential.cert(serviceAccount)
    });
    console.log('‚úÖ Firebase Admin initialis√© avec succ√®s!');
    
    // Test de connexion
    console.log('\nüìã Test de connexion...');
    admin.auth().listUsers(100)
      .then((result) => {
        console.log(`‚úÖ Connexion r√©ussie! ${result.users.length} utilisateur(s)`);
        process.exit(0);
      })
      .catch((error) => {
        console.error('‚ùå Erreur de connexion:', error.message);
        process.exit(1);
      });
  }
  
} catch (error) {
  console.error('‚ùå Erreur:', error.message);
  process.exit(1);
} 
------------------------------------------- 
 
[FICHIER 8] \app\admin\page.tsx 
------------------------------------------- 
'use client';

import { useState, useEffect } from 'react';
import { Post, getAllPosts } from '@/lib/firestore';
import { deletePost, updatePost } from '@/lib/firestore-admin';
import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { auth } from '@/lib/firebase';
import { onAuthStateChanged, User } from 'firebase/auth';
import { 
  FaEye, 
  FaEyeSlash, 
  FaEdit, 
  FaTrash, 
  FaExternalLinkAlt, 
  FaSync, 
  FaSearch, 
  FaFilter,
  FaUsers
} from 'react-icons/fa';

export default function AdminPage() {
  const [posts, setPosts] = useState<Post[]>([]);
  const [filteredPosts, setFilteredPosts] = useState<Post[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState<'all' | 'published' | 'draft'>('all');
  const [user, setUser] = useState<User | null>(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [updatingStatus, setUpdatingStatus] = useState<string | null>(null);
  const router = useRouter();

  // V√©rifier l'authentification et les permissions admin
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {
      if (currentUser) {
        setUser(currentUser);
        
        // V√©rifier si l'utilisateur est admin
        try {
          const idTokenResult = await currentUser.getIdTokenResult();
          if (idTokenResult.claims.role === 'admin') {
            setIsAdmin(true);
            loadPosts();
          } else {
            // Rediriger si non admin
            router.push('/');
          }
        } catch (error) {
          console.error('Erreur v√©rification admin:', error);
          router.push('/');
        }
      } else {
        // Rediriger si non connect√©
        router.push('/');
      }
    });

    return unsubscribe;
  }, [router]);

  // Charger les articles
  const loadPosts = async () => {
    try {
      setLoading(true);
      const allPosts = await getAllPosts();
      setPosts(allPosts);
      setFilteredPosts(allPosts);
    } catch (error) {
      console.error('Erreur lors du chargement des articles:', error);
    } finally {
      setLoading(false);
    }
  };

  // Filtrer les articles
  useEffect(() => {
    let result = posts;

    // Filtre par recherche
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      result = result.filter(post => 
        post.title.toLowerCase().includes(term) ||
        post.author.toLowerCase().includes(term) ||
        post.description.toLowerCase().includes(term) ||
        post.tags?.some(tag => tag.toLowerCase().includes(term))
      );
    }

    // Filtre par statut
    if (filterStatus !== 'all') {
      result = result.filter(post => 
        filterStatus === 'published' ? post.isPublished : !post.isPublished
      );
    }

    setFilteredPosts(result);
  }, [posts, searchTerm, filterStatus]);

  // Gestion de la suppression
  const handleDelete = async (postId: string) => {
    if (window.confirm('√ätes-vous s√ªr de vouloir supprimer cet article ? Cette action est irr√©versible.')) {
      try {
        const success = await deletePost(postId);
        if (success) {
          // Mettre √† jour la liste localement
          setPosts(prev => prev.filter(post => post.id !== postId));
          alert('Article supprim√© avec succ√®s !');
        } else {
          alert('Erreur lors de la suppression');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la suppression');
      }
    }
  };

  // Basculer le statut (publi√© ‚Üî brouillon)
  const togglePublishStatus = async (postId: string, currentStatus: boolean) => {
    setUpdatingStatus(postId);
    try {
      const success = await updatePost(postId, { isPublished: !currentStatus });
      
      if (success) {
        // Mettre √† jour l'√©tat local
        setPosts(prev => prev.map(post => 
          post.id === postId 
            ? { ...post, isPublished: !currentStatus }
            : post
        ));
        
        const newStatus = !currentStatus ? 'publi√©' : 'mis en brouillon';
        alert(`Article ${newStatus} avec succ√®s !`);
      } else {
        alert('Erreur lors du changement de statut');
      }
    } catch (error) {
      console.error('Erreur:', error);
      alert('Erreur lors du changement de statut');
    } finally {
      setUpdatingStatus(null);
    }
  };

  // Publier tous les brouillons
  const publishAllDrafts = async () => {
    if (window.confirm('Voulez-vous vraiment publier tous les brouillons ?')) {
      try {
        const drafts = posts.filter(p => !p.isPublished);
        let successCount = 0;
        
        for (const draft of drafts) {
          const success = await updatePost(draft.id, { isPublished: true });
          if (success) successCount++;
        }
        
        // Recharger les articles
        await loadPosts();
        alert(`${successCount} brouillon(s) publi√©(s) avec succ√®s !`);
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la publication des brouillons');
      }
    }
  };

  // Formater la date
  const formatDate = (timestamp: any) => {
    if (!timestamp) return 'N/A';
    try {
      return timestamp.toDate().toLocaleDateString('fr-FR', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch (error) {
      return 'Date invalide';
    }
  };

  // Raccourcir le texte pour l'affichage
  const truncateText = (text: string, maxLength: number) => {
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength) + '...';
  };

  if (!isAdmin) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center">
        <div className="text-white text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-6"></div>
          <h2 className="text-xl font-semibold mb-2">V√©rification des permissions</h2>
          <p className="text-gray-400">Redirection en cours...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-gray-100 p-4 md:p-8">
      <div className="max-w-7xl mx-auto">
        {/* En-t√™te */}
        <header className="mb-8">
          <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
            <div>
              <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">
                <span className="bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                  Tableau de Bord Admin
                </span>
              </h1>
              <p className="text-gray-400">
                G√©rez et mod√©rez le contenu de votre blog
              </p>
            </div>
            
            <div className="flex flex-wrap gap-3">
              {/* Bouton pour g√©rer les utilisateurs */}
              <Link
                href="/admin/users"
                className="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl"
                title="G√©rer les utilisateurs et les r√¥les"
              >
                <FaUsers className="text-lg" />
                G√©rer les utilisateurs
              </Link>
              
              <Link
                href="/admin/new"
                className="px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl"
              >
                <span className="text-lg">+</span> Nouvel Article
              </Link>
              
              <button
                onClick={loadPosts}
                className="px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl"
              >
                <FaSync className={loading ? 'animate-spin' : ''} />
                {loading ? 'Chargement...' : 'Actualiser'}
              </button>
            </div>
          </div>

          {/* Statistiques */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700 hover:border-blue-500 transition-all duration-300">
              <div className="text-3xl font-bold text-white mb-1">{posts.length}</div>
              <div className="text-gray-400 text-sm">Total articles</div>
              <div className="h-1 w-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full mt-2"></div>
            </div>
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700 hover:border-green-500 transition-all duration-300">
              <div className="text-3xl font-bold text-green-400 mb-1">
                {posts.filter(p => p.isPublished).length}
              </div>
              <div className="text-gray-400 text-sm">Articles publi√©s</div>
              <div className="h-1 w-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full mt-2"></div>
            </div>
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700 hover:border-yellow-500 transition-all duration-300">
              <div className="text-3xl font-bold text-yellow-400 mb-1">
                {posts.filter(p => !p.isPublished).length}
              </div>
              <div className="text-gray-400 text-sm">Brouillons</div>
              <div className="h-1 w-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full mt-2"></div>
            </div>
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700 hover:border-purple-500 transition-all duration-300">
              <div className="text-3xl font-bold text-white mb-1">{filteredPosts.length}</div>
              <div className="text-gray-400 text-sm">Filtr√©s</div>
              <div className="h-1 w-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full mt-2"></div>
            </div>
          </div>
        </header>

        {/* Barre de contr√¥le */}
        <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 mb-6 border border-slate-700">
          <div className="flex flex-col md:flex-row gap-4">
            {/* Barre de recherche */}
            <div className="flex-1 relative">
              <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <FaSearch className="text-gray-500" />
              </div>
              <input
                type="text"
                placeholder="Rechercher un article..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full pl-10 pr-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
              />
            </div>

            {/* Filtres */}
            <div className="flex gap-2">
              <button
                onClick={() => setFilterStatus('all')}
                className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all duration-200 ${filterStatus === 'all' ? 'bg-gradient-to-r from-blue-600 to-cyan-600 shadow-lg' : 'bg-slate-700 hover:bg-slate-600'}`}
              >
                <FaFilter /> Tous
              </button>
              <button
                onClick={() => setFilterStatus('published')}
                className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all duration-200 ${filterStatus === 'published' ? 'bg-gradient-to-r from-green-600 to-emerald-600 shadow-lg' : 'bg-slate-700 hover:bg-slate-600'}`}
              >
                <FaEye /> Publi√©s
              </button>
              <button
                onClick={() => setFilterStatus('draft')}
                className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all duration-200 ${filterStatus === 'draft' ? 'bg-gradient-to-r from-yellow-600 to-orange-600 shadow-lg' : 'bg-slate-700 hover:bg-slate-600'}`}
              >
                <FaEyeSlash /> Brouillons
              </button>
            </div>

            {/* Bouton publier tous les brouillons */}
            {posts.filter(p => !p.isPublished).length > 0 && (
              <button
                onClick={publishAllDrafts}
                className="px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2"
              >
                <FaSync /> Publier tous ({posts.filter(p => !p.isPublished).length})
              </button>
            )}
          </div>
        </div>

        {/* Tableau des articles */}
        <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700">
          {loading ? (
            <div className="p-12 text-center">
              <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"></div>
              <h3 className="text-xl font-semibold text-white mb-2">Chargement des articles</h3>
              <p className="text-gray-400">Veuillez patienter...</p>
            </div>
          ) : filteredPosts.length === 0 ? (
            <div className="p-12 text-center">
              <div className="text-6xl mb-4">üìù</div>
              <h3 className="text-xl font-semibold text-white mb-2">Aucun article trouv√©</h3>
              <p className="text-gray-400 mb-4">
                {searchTerm || filterStatus !== 'all' 
                  ? 'Essayez de modifier vos crit√®res de recherche'
                  : 'Commencez par cr√©er votre premier article'}
              </p>
              {(searchTerm || filterStatus !== 'all') && (
                <button
                  onClick={() => {
                    setSearchTerm('');
                    setFilterStatus('all');
                  }}
                  className="px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-lg transition-all duration-200"
                >
                  R√©initialiser les filtres
                </button>
              )}
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-900/80">
                  <tr>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Article</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Auteur</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Statut</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Date</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {filteredPosts.map((post) => (
                    <tr 
                      key={post.id} 
                      className="border-b border-slate-700/50 hover:bg-slate-700/30 transition-all duration-150 group"
                    >
                      <td className="py-4 px-4">
                        <div className="flex items-start gap-3">
                          {post.imageUrl && (
                            <div className="relative w-16 h-12 flex-shrink-0 rounded-lg overflow-hidden border border-slate-600 group-hover:border-blue-500 transition-all duration-200">
                              <img
                                src={post.imageUrl}
                                alt={post.title}
                                className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                                onError={(e) => {
                                  e.currentTarget.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="64" height="48" viewBox="0 0 24 24" fill="%23374151"><rect width="24" height="24" rx="4"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="Arial" font-size="8" fill="%236b7280">Image</text></svg>';
                                }}
                              />
                            </div>
                          )}
                          <div>
                            <h3 className="font-semibold text-white group-hover:text-blue-400 transition-colors duration-200">
                              {truncateText(post.title, 50)}
                            </h3>
                            <p className="text-sm text-gray-400 mt-1">
                              {truncateText(post.description, 80)}
                            </p>
                            <div className="flex flex-wrap gap-1 mt-2">
                              {post.tags?.slice(0, 3).map((tag, index) => (
                                <span 
                                  key={index} 
                                  className="px-2 py-0.5 text-xs bg-slate-700 rounded-full hover:bg-slate-600 transition-colors duration-200"
                                >
                                  {tag}
                                </span>
                              ))}
                              {post.tags && post.tags.length > 3 && (
                                <span className="px-2 py-0.5 text-xs bg-slate-700 rounded-full">
                                  +{post.tags.length - 3}
                                </span>
                              )}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td className="py-4 px-4">
                        <div className="text-gray-300">{post.author}</div>
                      </td>
                      <td className="py-4 px-4">
                        <button
                          onClick={() => togglePublishStatus(post.id, post.isPublished)}
                          disabled={updatingStatus === post.id}
                          className={`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1.5 transition-all duration-200 ${post.isPublished 
                            ? 'bg-gradient-to-r from-green-900/30 to-emerald-900/30 text-green-400 hover:from-green-800/40 hover:to-emerald-800/40' 
                            : 'bg-gradient-to-r from-yellow-900/30 to-orange-900/30 text-yellow-400 hover:from-yellow-800/40 hover:to-orange-800/40'
                          } ${updatingStatus === post.id ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'}`}
                        >
                          {updatingStatus === post.id ? (
                            <FaSync className="animate-spin" />
                          ) : post.isPublished ? (
                            <FaEye />
                          ) : (
                            <FaEyeSlash />
                          )}
                          {updatingStatus === post.id ? '...' : post.isPublished ? 'Publi√©' : 'Brouillon'}
                        </button>
                      </td>
                      <td className="py-4 px-4">
                        <div className="text-gray-400 text-sm">
                          {formatDate(post.createdAt)}
                        </div>
                      </td>
                      <td className="py-4 px-4">
                        <div className="flex gap-2">
                          {/* Bouton Modifier - CORRIG√â : utilise post.slug */}
                          <Link
                            href={`/admin/edit/${post.slug}`}
                            className="px-3 py-1.5 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white text-sm font-medium rounded-lg transition-all duration-200 flex items-center gap-1.5 hover:scale-105"
                            title="Modifier"
                          >
                            <FaEdit /> Modifier
                          </Link>
                          
                          {/* Bouton Voir */}
                          <Link
                            href={`/posts/${post.slug}`}
                            target="_blank"
                            className="px-3 py-1.5 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-sm font-medium rounded-lg transition-all duration-200 flex items-center gap-1.5 hover:scale-105"
                            title="Voir en ligne"
                          >
                            <FaExternalLinkAlt /> Voir
                          </Link>
                          
                          {/* Bouton Supprimer */}
                          <button
                            onClick={() => handleDelete(post.id)}
                            className="px-3 py-1.5 bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 text-white text-sm font-medium rounded-lg transition-all duration-200 flex items-center gap-1.5 hover:scale-105"
                            title="Supprimer"
                          >
                            <FaTrash /> Supprimer
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>

        {/* Pied de page */}
        <div className="mt-8 text-center text-gray-500 text-sm">
          <p>Connect√© en tant que <span className="text-blue-400">{user?.email}</span></p>
          <p className="mt-1">
            {filteredPosts.length} article{filteredPosts.length > 1 ? 's' : ''} affich√©{filteredPosts.length > 1 ? 's' : ''}
            {filterStatus !== 'all' && ` (filtr√©${filterStatus === 'published' ? ' publi√©s' : ' brouillons'})`}
          </p>
        </div>
      </div>
    </div>
  );
} 
------------------------------------------- 
 
[FICHIER 9] \app\admin\edit\[slug]\page.tsx 
------------------------------------------- 
"use client";

import { useEffect, useState, useRef } from "react";
import { useParams, useRouter } from "next/navigation";
import { auth } from "@/lib/firebase";
import { onAuthStateChanged } from "firebase/auth";
import { getPostBySlug } from "@/lib/firestore";
import { updatePost } from "@/lib/firestore-admin";
import RichTextEditor from "@/components/RichTextEditor";

type Post = {
  id: string;
  title: string;
  slug: string;
  content: string;
  author: string;
  description: string;
  imageUrl?: string;
  isPublished: boolean;
  tags: string[];
  createdAt?: Date;
  updatedAt?: Date;
};

export default function EditPostPage() {
  const { slug } = useParams<{ slug: string }>();
  const router = useRouter();
  const [isInitialLoadComplete, setIsInitialLoadComplete] = useState(false);
  const [hasForceReloaded, setHasForceReloaded] = useState(false);

  const [checkingAuth, setCheckingAuth] = useState(true);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);

  const [postId, setPostId] = useState<string | null>(null);
  const [formData, setFormData] = useState<Post | null>(null);
  const [tagInput, setTagInput] = useState("");
  
  // R√©f√©rence pour stocker le contenu initial
  const initialContentRef = useRef<string>("");

  // Fonction pour g√©n√©rer un slug propre
  const generateSlug = (title: string) => {
    return title
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .replace(/[^\w\s-]/gi, "")
      .replace(/\s+/g, "-")
      .replace(/-+/g, "-")
      .trim();
  };

  // Fonction pour charger les donn√©es
  const loadPostData = async () => {
    try {
      console.log("üîç Chargement des donn√©es pour slug:", slug);
      const data = await getPostBySlug(slug);
      
      if (!data) {
        alert("Article introuvable");
        router.push("/admin");
        return null;
      }

      console.log("üì¶ Donn√©es r√©cup√©r√©es:", {
        id: data.id,
        title: data.title,
        contentLength: data.content?.length || 0,
        contentPreview: data.content?.substring(0, 100)
      });

      const post: Post = {
        id: data.id,
        title: data.title,
        slug: data.slug,
        content: data.content || "<p></p>",
        author: data.author,
        description: data.description,
        imageUrl: data.imageUrl || "",
        isPublished: data.isPublished,
        tags: data.tags || [],
      };

      // Stocker le contenu dans la ref
      initialContentRef.current = data.content || "<p></p>";
      
      return post;
    } catch (error) {
      console.error("‚ùå Erreur lors du chargement:", error);
      throw error;
    }
  };

  // üîê V√©rification admin
  useEffect(() => {
    const unsub = onAuthStateChanged(auth, async (user) => {
      if (!user) {
        router.replace("/");
        return;
      }

      try {
        const token = await user.getIdTokenResult();
        if (token.claims.role !== "admin") {
          router.replace("/");
          return;
        }
        setCheckingAuth(false);
      } catch (error) {
        console.error("Erreur v√©rification admin:", error);
        router.replace("/");
      }
    });

    return () => unsub();
  }, [router]);

  // üì• Premier chargement (chargement initial)
  useEffect(() => {
    if (!slug || checkingAuth) return;

    const fetchInitialData = async () => {
      try {
        setLoading(true);
        const post = await loadPostData();
        
        if (post) {
          setPostId(post.id);
          setFormData(post);
          console.log("‚úÖ Donn√©es initiales charg√©es");
        }
      } catch (error) {
        alert("Erreur lors du chargement de l'article");
        router.push("/admin");
      } finally {
        setLoading(false);
        // Marquer que le chargement initial est termin√©
        setTimeout(() => {
          setIsInitialLoadComplete(true);
          console.log("üèÅ Chargement initial termin√©");
        }, 100);
      }
    };

    fetchInitialData();
  }, [slug, checkingAuth, router]);

  // üì• Second chargement FORC√â apr√®s que tout est pr√™t
  useEffect(() => {
    if (!isInitialLoadComplete || hasForceReloaded || !postId) return;

    console.log("üîÑ D√©clenchement du rechargement forc√©...");

    const forceReloadContent = async () => {
      try {
        console.log("üîÑ Rechargement des donn√©es pour remplir Quill...");
        const post = await loadPostData();
        
        if (post && formData) {
          // Mettre √† jour uniquement le contenu
          setFormData({
            ...formData,
            content: post.content || "<p></p>"
          });
          console.log("‚úÖ Contenu recharg√© dans le formulaire");
        }
      } catch (error) {
        console.error("‚ö†Ô∏è Erreur lors du rechargement:", error);
      } finally {
        setHasForceReloaded(true);
        console.log("‚úÖ Rechargement forc√© termin√©");
      }
    };

    // D√©lai pour s'assurer que Quill est initialis√©
    const timer = setTimeout(() => {
      forceReloadContent();
    }, 500);

    return () => clearTimeout(timer);
  }, [isInitialLoadComplete, postId, hasForceReloaded, formData]);

  const handleAddTag = () => {
    if (
      tagInput.trim() &&
      formData &&
      !formData.tags.includes(tagInput.trim())
    ) {
      setFormData({
        ...formData,
        tags: [...formData.tags, tagInput.trim()],
      });
      setTagInput("");
    }
  };

  const handleRemoveTag = (tag: string) => {
    if (!formData) return;
    setFormData({
      ...formData,
      tags: formData.tags.filter((t) => t !== tag),
    });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!formData || !postId) return;

    // Validation
    if (!formData.title.trim()) {
      alert("Le titre est obligatoire");
      return;
    }

    if (!formData.content || 
        formData.content.trim() === "<p><br></p>" || 
        formData.content.trim() === "" ||
        formData.content.trim() === "<p></p>") {
      alert("Le contenu est obligatoire");
      return;
    }

    if (!formData.description.trim()) {
      alert("La description est obligatoire");
      return;
    }

    setSaving(true);

    try {
      // Pr√©parer les donn√©es pour la mise √† jour
      const payload = {
        title: formData.title,
        slug: formData.slug || generateSlug(formData.title),
        content: formData.content,
        author: formData.author,
        description: formData.description,
        imageUrl: formData.imageUrl || "",
        isPublished: formData.isPublished,
        tags: formData.tags,
      };

      const success = await updatePost(postId, payload);

      if (success) {
        alert("Article mis √† jour avec succ√®s !");
        router.push("/admin");
      } else {
        throw new Error("√âchec de la mise √† jour dans Firestore");
      }
    } catch (error) {
      console.error("Erreur lors de la mise √† jour:", error);
      alert("Erreur lors de la mise √† jour : " + (error as Error).message);
    } finally {
      setSaving(false);
    }
  };

  // Fonction pour forcer manuellement le rechargement
  const handleForceReload = async () => {
    setHasForceReloaded(false);
    setIsInitialLoadComplete(false);
    
    setTimeout(async () => {
      try {
        const post = await loadPostData();
        if (post && formData) {
          setFormData({
            ...formData,
            content: post.content || "<p></p>"
          });
          console.log("üîÑ Rechargement manuel r√©ussi");
        }
      } catch (error) {
        console.error("Erreur rechargement manuel:", error);
      } finally {
        setHasForceReloaded(true);
        setIsInitialLoadComplete(true);
      }
    }, 300);
  };

  if (checkingAuth) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center">
        <div className="text-white text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500 mx-auto mb-6"></div>
          <h2 className="text-xl font-semibold mb-2">V√©rification des permissions</h2>
          <p className="text-gray-400">Veuillez patienter...</p>
        </div>
      </div>
    );
  }

  if (loading || !formData) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center">
        <div className="text-white text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-green-500 mx-auto mb-6"></div>
          <h2 className="text-xl font-semibold mb-2">Chargement de l'article</h2>
          <p className="text-gray-400">Veuillez patienter...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-gray-100 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        {/* En-t√™te avec bouton de rechargement */}
        <header className="mb-8">
          <div className="flex justify-between items-start mb-2">
            <div>
              <h1 className="text-3xl md:text-4xl font-bold text-white mb-2">
                <span className="bg-gradient-to-r from-green-500 to-emerald-600 bg-clip-text text-transparent">
                  Modifier l'article
                </span>
              </h1>
              <p className="text-gray-400">
                Modifiez les informations de l'article ci-dessous
              </p>
            </div>
            
            <button
              type="button"
              onClick={handleForceReload}
              className="px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white text-sm font-medium rounded-lg transition-all duration-200 flex items-center gap-2"
              title="Recharger le contenu depuis la base de donn√©es"
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
              </svg>
              Recharger
            </button>
          </div>
          
          {/* Indicateurs de statut */}
          <div className="flex flex-wrap gap-2 mb-4">
            <span className="px-3 py-1 text-xs rounded-full bg-blue-900/50 text-blue-300">
              Post ID: {postId?.substring(0, 8)}...
            </span>
            <span className="px-3 py-1 text-xs rounded-full bg-green-900/50 text-green-300">
              Slug: {formData.slug}
            </span>
            <span className="px-3 py-1 text-xs rounded-full bg-purple-900/50 text-purple-300">
              {formData.isPublished ? 'Publi√©' : 'Brouillon'}
            </span>
          </div>
        </header>

        <form onSubmit={handleSubmit} className="space-y-8">
          {/* Titre et Slug */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className="block text-sm font-medium mb-3 text-gray-300">
                Titre *
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={(e) => {
                  setFormData({ ...formData, title: e.target.value });
                  if (!formData.slug) {
                    setFormData((prev) => ({
                      ...prev!,
                      slug: generateSlug(e.target.value),
                    }));
                  }
                }}
                className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 text-white"
                placeholder="Titre de l'article"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-3 text-gray-300">
                Slug
              </label>
              <input
                type="text"
                value={formData.slug}
                onChange={(e) =>
                  setFormData({ ...formData, slug: e.target.value })
                }
                className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-white"
                placeholder="slug-de-l-article"
              />
              <p className="text-xs text-gray-500 mt-2">
                Laissez vide pour g√©n√©rer automatiquement √† partir du titre
              </p>
            </div>
          </div>

          {/* Auteur et Image */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className="block text-sm font-medium mb-3 text-gray-300">
                Auteur *
              </label>
              <input
                type="text"
                required
                value={formData.author}
                onChange={(e) =>
                  setFormData({ ...formData, author: e.target.value })
                }
                className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-white"
                placeholder="Nom de l'auteur"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-3 text-gray-300">
                URL de l'image
              </label>
              <input
                type="url"
                value={formData.imageUrl || ""}
                onChange={(e) =>
                  setFormData({ ...formData, imageUrl: e.target.value })
                }
                className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-white"
                placeholder="https://example.com/image.jpg"
              />
              {formData.imageUrl && (
                <div className="mt-3">
                  <p className="text-xs text-gray-500 mb-2">Aper√ßu:</p>
                  <div className="relative w-32 h-20 rounded-lg overflow-hidden border border-slate-700">
                    <img
                      src={formData.imageUrl}
                      alt="Aper√ßu"
                      className="w-full h-full object-cover"
                      onError={(e) => {
                        e.currentTarget.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='80' viewBox='0 0 24 24' fill='%23374151'%3E%3Crect width='24' height='24' rx='4'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='8' fill='%236b7280'%3EImage%3C/text%3E%3C/svg%3E";
                      }}
                    />
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* Description */}
          <div>
            <label className="block text-sm font-medium mb-3 text-gray-300">
              Description *
            </label>
            <textarea
              required
              rows={3}
              value={formData.description}
              onChange={(e) =>
                setFormData({ ...formData, description: e.target.value })
              }
              className="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-white"
              placeholder="Br√®ve description de l'article"
            />
            <p className="text-xs text-gray-500 mt-2">
              Cette description appara√Ætra dans les aper√ßus d'articles
            </p>
          </div>

          {/* Tags */}
          <div>
            <label className="block text-sm font-medium mb-3 text-gray-300">
              Tags
            </label>
            <div className="flex gap-2 mb-3">
              <input
                type="text"
                value={tagInput}
                onChange={(e) => setTagInput(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === "Enter") {
                    e.preventDefault();
                    handleAddTag();
                  }
                }}
                className="flex-1 px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 text-white"
                placeholder="Ajouter un tag..."
              />
              <button
                type="button"
                onClick={handleAddTag}
                className="px-4 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2"
              >
                <span className="text-lg">+</span> Ajouter
              </button>
            </div>

            <div className="flex flex-wrap gap-2">
              {formData.tags.map((tag, index) => (
                <div
                  key={index}
                  className="flex items-center gap-2 px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded-full transition-all duration-200 group"
                >
                  <span className="text-sm">{tag}</span>
                  <button
                    type="button"
                    onClick={() => handleRemoveTag(tag)}
                    className="text-gray-400 hover:text-red-400 transition-colors duration-200 text-sm"
                    title="Supprimer ce tag"
                  >
                    √ó
                  </button>
                </div>
              ))}
              {formData.tags.length === 0 && (
                <p className="text-sm text-gray-500 italic">
                  Aucun tag ajout√©. Ajoutez des tags pour faciliter la recherche.
                </p>
              )}
            </div>
          </div>

          {/* üìù Contenu (RichTextEditor) */}
          <div>
            <div className="flex justify-between items-center mb-3">
              <label className="block text-sm font-medium text-gray-300">
                Contenu *
              </label>
              <div className="flex items-center gap-2">
                <span className="text-xs text-gray-500">
                  Longueur: {formData.content?.length || 0} caract√®res
                </span>
                <button
                  type="button"
                  onClick={handleForceReload}
                  className="text-xs text-blue-400 hover:text-blue-300"
                  title="Recharger le contenu"
                >
                  ‚ü≥ Recharger
                </button>
              </div>
            </div>
            
            <div className="bg-white text-black rounded-lg overflow-hidden border border-slate-700 shadow-lg">
              <RichTextEditor
                key={`editor-${postId}-${hasForceReloaded ? 'reloaded' : 'initial'}`}
                value={formData.content}
                onChange={(html) =>
                  setFormData({ ...formData, content: html })
                }
                className="min-h-[400px]"
              />
            </div>
            
            <div className="mt-2 flex justify-between items-center">
              <p className="text-sm text-gray-400">
                Utilisez l'√©diteur pour formater votre contenu.
              </p>
              <div className="text-xs">
                {!hasForceReloaded ? (
                  <span className="text-yellow-500">‚è≥ Chargement en cours...</span>
                ) : (
                  <span className="text-green-500">‚úì Contenu charg√©</span>
                )}
              </div>
            </div>
          </div>

          {/* Options */}
          <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 pt-6 border-t border-slate-700">
            <div className="flex items-center gap-3">
              <label className="flex items-center gap-3 cursor-pointer">
                <div className="relative">
                  <input
                    type="checkbox"
                    checked={formData.isPublished}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        isPublished: e.target.checked,
                      })
                    }
                    className="sr-only"
                  />
                  <div className={`w-10 h-6 rounded-full transition-all duration-200 ${formData.isPublished ? 'bg-green-500' : 'bg-slate-700'}`}>
                    <div className={`absolute top-1 w-4 h-4 rounded-full bg-white transition-all duration-200 ${formData.isPublished ? 'left-5' : 'left-1'}`}></div>
                  </div>
                </div>
                <span className="text-sm font-medium">
                  {formData.isPublished ? 'Article publi√©' : 'Article en brouillon'}
                </span>
              </label>
              
              {formData.createdAt && (
                <div className="text-xs text-gray-500">
                  Cr√©√© le: {new Date(formData.createdAt).toLocaleDateString('fr-FR')}
                </div>
              )}
            </div>

            <div className="flex gap-3">
              <button
                type="button"
                onClick={() => router.push("/admin")}
                className="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2"
                disabled={saving}
              >
                Annuler
              </button>

              <button
                type="submit"
                disabled={saving}
                className="px-6 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {saving ? (
                  <>
                    <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                    Sauvegarde en cours...
                  </>
                ) : (
                  "Enregistrer les modifications"
                )}
              </button>
            </div>
          </div>
        </form>

        {/* Informations */}
        <div className="mt-8 bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700">
          <h3 className="text-lg font-semibold text-white mb-3">D√©bogage</h3>
          <ul className="text-gray-400 space-y-2 text-sm">
            <li className="flex items-start gap-2">
              <span className="text-blue-400 mt-1">‚Ä¢</span>
              <span>Post ID: <code className="bg-slate-900 px-2 py-1 rounded">{postId}</code></span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-green-400 mt-1">‚Ä¢</span>
              <span>Contenu initial: <code className="bg-slate-900 px-2 py-1 rounded">{initialContentRef.current?.length || 0} caract√®res</code></span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-yellow-400 mt-1">‚Ä¢</span>
              <span>Rechargement forc√©: <code className="bg-slate-900 px-2 py-1 rounded">{hasForceReloaded ? "OUI" : "NON"}</code></span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-purple-400 mt-1">‚Ä¢</span>
              <span>Chargement initial termin√©: <code className="bg-slate-900 px-2 py-1 rounded">{isInitialLoadComplete ? "OUI" : "NON"}</code></span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  );
} 
------------------------------------------- 
 
[FICHIER 10] \app\admin\new\page.tsx 
------------------------------------------- 
"use client";

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import { auth } from "@/lib/firebase";
import { onAuthStateChanged, User } from "firebase/auth";
import { createPost } from "@/lib/firestore-admin";
import RichTextEditor from "@/components/RichTextEditor";

export default function NewPostPage() {
  const router = useRouter();
  const [user, setUser] = useState<User | null>(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [loading, setLoading] = useState(false);

  const [formData, setFormData] = useState({
    title: "",
    slug: "",
    content: "",
    author: "",
    description: "",
    imageUrl: "",
    isPublished: false,
    tags: [] as string[],
  });

  const [tagInput, setTagInput] = useState("");

  // üîê V√©rification de l'authentification + r√¥le admin
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {
      if (!currentUser) {
        router.push("/");
        return;
      }

      setUser(currentUser);

      try {
        const idTokenResult = await currentUser.getIdTokenResult();
        if (idTokenResult.claims.role === "admin") {
          setIsAdmin(true);
          setFormData((prev) => ({
            ...prev,
            author:
              currentUser.displayName ||
              currentUser.email?.split("@")[0] ||
              "Admin",
          }));
        } else {
          router.push("/");
        }
      } catch {
        router.push("/");
      }
    });

    return unsubscribe;
  }, [router]);

  // üî§ G√©n√©ration automatique du slug
  const generateSlug = (title: string) =>
    title
      .toLowerCase()
      .replace(/[^\w\s]/gi, "")
      .replace(/\s+/g, "-")
      .replace(/-+/g, "-")
      .trim();

  // üìù Soumission du formulaire
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    // Validation du contenu (Quill)
    if (!formData.content || formData.content === "<p><br></p>") {
      alert("Le contenu de l'article est obligatoire");
      setLoading(false);
      return;
    }

    try {
      const postId = await createPost({
        ...formData,
        slug: formData.slug || generateSlug(formData.title),
      });

      if (postId) {
        alert("Article cr√©√© avec succ√®s !");
        router.push("/admin");
      } else {
        alert("Erreur lors de la cr√©ation");
      }
    } catch (error) {
      console.error("Erreur:", error);
      alert("Erreur lors de la cr√©ation");
    } finally {
      setLoading(false);
    }
  };

  // üè∑Ô∏è Gestion des tags
  const handleAddTag = () => {
    if (tagInput.trim() && !formData.tags.includes(tagInput.trim())) {
      setFormData({
        ...formData,
        tags: [...formData.tags, tagInput.trim()],
      });
      setTagInput("");
    }
  };

  const handleRemoveTag = (tagToRemove: string) => {
    setFormData({
      ...formData,
      tags: formData.tags.filter((tag) => tag !== tagToRemove),
    });
  };

  // ‚è≥ Loading / s√©curit√©
  if (!isAdmin) {
    return (
      <div className="min-h-screen bg-slate-900 flex items-center justify-center">
        <div className="text-white text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
          <p>V√©rification des permissions...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-slate-900 text-gray-100 p-4 md:p-8">
      <div className="max-w-4xl mx-auto">
        <header className="mb-8">
          <h1 className="text-3xl font-bold text-white mb-2">
            Cr√©er un nouvel article
          </h1>
          <p className="text-gray-400">
            Remplissez le formulaire pour cr√©er un nouvel article
          </p>
        </header>

        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Titre et Slug */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-2">
                Titre *
              </label>
              <input
                type="text"
                required
                value={formData.title}
                onChange={(e) => {
                  setFormData({ ...formData, title: e.target.value });
                  if (!formData.slug) {
                    setFormData((prev) => ({
                      ...prev,
                      slug: generateSlug(e.target.value),
                    }));
                  }
                }}
                className="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">
                Slug
              </label>
              <input
                type="text"
                value={formData.slug}
                onChange={(e) =>
                  setFormData({ ...formData, slug: e.target.value })
                }
                className="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg"
              />
            </div>
          </div>

          {/* Auteur et Image */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-2">
                Auteur *
              </label>
              <input
                type="text"
                required
                value={formData.author}
                onChange={(e) =>
                  setFormData({ ...formData, author: e.target.value })
                }
                className="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg"
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">
                URL de l'image
              </label>
              <input
                type="url"
                value={formData.imageUrl}
                onChange={(e) =>
                  setFormData({ ...formData, imageUrl: e.target.value })
                }
                className="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg"
              />
            </div>
          </div>

          {/* Description */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Description *
            </label>
            <textarea
              required
              rows={3}
              value={formData.description}
              onChange={(e) =>
                setFormData({ ...formData, description: e.target.value })
              }
              className="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg"
            />
          </div>

          {/* Tags */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Tags
            </label>
            <div className="flex gap-2 mb-2">
              <input
                type="text"
                value={tagInput}
                onChange={(e) => setTagInput(e.target.value)}
                onKeyDown={(e) =>
                  e.key === "Enter" && (e.preventDefault(), handleAddTag())
                }
                className="flex-1 px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg"
              />
              <button
                type="button"
                onClick={handleAddTag}
                className="px-4 py-2 bg-blue-600 rounded-lg"
              >
                Ajouter
              </button>
            </div>

            <div className="flex flex-wrap gap-2">
              {formData.tags.map((tag, index) => (
                <div
                  key={index}
                  className="flex items-center gap-1 px-3 py-1 bg-slate-700 rounded-full"
                >
                  <span>{tag}</span>
                  <button
                    type="button"
                    onClick={() => handleRemoveTag(tag)}
                    className="ml-1"
                  >
                    √ó
                  </button>
                </div>
              ))}
            </div>
          </div>

          {/* üìù Contenu (Quill natif) */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Contenu *
            </label>

            <div className="bg-white text-black rounded-lg overflow-hidden border border-slate-700">
              <RichTextEditor
                value={formData.content}
                onChange={(html) =>
                  setFormData({ ...formData, content: html })
                }
              />
            </div>

            <p className="text-sm text-gray-400 mt-2">
              Le contenu est g√©n√©r√© automatiquement en HTML
            </p>
          </div>

          {/* Options */}
          <div className="flex items-center justify-between pt-4 border-t border-slate-700">
            <label className="flex items-center gap-2 text-sm">
              <input
                type="checkbox"
                checked={formData.isPublished}
                onChange={(e) =>
                  setFormData({
                    ...formData,
                    isPublished: e.target.checked,
                  })
                }
              />
              Publier imm√©diatement
            </label>

            <div className="flex gap-3">
              <button
                type="button"
                onClick={() => router.push("/admin")}
                className="px-4 py-2 bg-slate-700 rounded-lg"
              >
                Annuler
              </button>

              <button
                type="submit"
                disabled={loading}
                className="px-4 py-2 bg-green-600 rounded-lg disabled:opacity-50"
              >
                {loading ? "Cr√©ation..." : "Cr√©er l'article"}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
}
 
------------------------------------------- 
 
[FICHIER 11] \app\admin\users\page.tsx 
------------------------------------------- 
'use client';

import { useState, useEffect } from 'react';
import { auth } from '@/lib/firebase';
import { onAuthStateChanged, User } from 'firebase/auth';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { 
  FaUser, 
  FaUserShield, 
  FaUserTimes, 
  FaUserCheck, 
  FaArrowLeft,
  FaSearch,
  FaEnvelope,
  FaCalendarAlt,
  FaCrown
} from 'react-icons/fa';

// Service pour g√©rer les r√¥les (√† cr√©er)
import { 
  getAllUsers, 
  setUserAdminRole, 
  removeUserAdminRole,
  UserWithRole 
} from '@/lib/user-management';

export default function UsersAdminPage() {
  const [users, setUsers] = useState<UserWithRole[]>([]);
  const [filteredUsers, setFilteredUsers] = useState<UserWithRole[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterRole, setFilterRole] = useState<'all' | 'admin' | 'user'>('all');
  const [currentUser, setCurrentUser] = useState<User | null>(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [updatingUser, setUpdatingUser] = useState<string | null>(null);
  const router = useRouter();

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, async (user) => {
      if (user) {
        setCurrentUser(user);
        
        try {
          const idTokenResult = await user.getIdTokenResult();
          if (idTokenResult.claims.role === 'admin') {
            setIsAdmin(true);
            loadUsers();
          } else {
            router.push('/');
          }
        } catch (error) {
          router.push('/');
        }
      } else {
        router.push('/');
      }
    });

    return unsubscribe;
  }, [router]);

  const loadUsers = async () => {
    try {
      setLoading(true);
      const allUsers = await getAllUsers();
      setUsers(allUsers);
      setFilteredUsers(allUsers);
    } catch (error) {
      console.error('Erreur lors du chargement des utilisateurs:', error);
    } finally {
      setLoading(false);
    }
  };

  // Filtrer les utilisateurs
  useEffect(() => {
    let result = users;

    // Filtre par recherche
    if (searchTerm) {
      const term = searchTerm.toLowerCase();
      result = result.filter(user => 
        user.email?.toLowerCase().includes(term) ||
        user.displayName?.toLowerCase().includes(term) ||
        user.uid.includes(term)
      );
    }

    // Filtre par r√¥le
    if (filterRole !== 'all') {
      result = result.filter(user => 
        filterRole === 'admin' ? user.isAdmin : !user.isAdmin
      );
    }

    setFilteredUsers(result);
  }, [users, searchTerm, filterRole]);

  const handleMakeAdmin = async (userId: string, email: string) => {
    if (window.confirm(`Donner les droits administrateur √† ${email} ?`)) {
      setUpdatingUser(userId);
      try {
        const success = await setUserAdminRole(userId);
        if (success) {
          await loadUsers();
          alert(`${email} est maintenant administrateur`);
        } else {
          alert('Erreur lors de la mise √† jour');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la mise √† jour');
      } finally {
        setUpdatingUser(null);
      }
    }
  };

  const handleRemoveAdmin = async (userId: string, email: string) => {
    if (window.confirm(`Retirer les droits administrateur √† ${email} ?`)) {
      setUpdatingUser(userId);
      try {
        const success = await removeUserAdminRole(userId);
        if (success) {
          await loadUsers();
          alert(`${email} n'est plus administrateur`);
        } else {
          alert('Erreur lors de la mise √† jour');
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la mise √† jour');
      } finally {
        setUpdatingUser(null);
      }
    }
  };

  const formatDate = (dateString?: string | null) => {
  if (!dateString) return 'N/A';
  return new Date(dateString).toLocaleDateString('fr-FR');
};

  if (!isAdmin) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex items-center justify-center">
        <div className="text-white text-center">
          <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500 mx-auto mb-6"></div>
          <h2 className="text-xl font-semibold mb-2">V√©rification des permissions</h2>
          <p className="text-gray-400">Redirection en cours...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-gray-100 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        {/* En-t√™te */}
        <header className="mb-8">
          <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
            <div>
              <div className="flex items-center gap-3 mb-2">
                <Link
                  href="/admin"
                  className="text-gray-400 hover:text-white transition-colors duration-200"
                  title="Retour au tableau de bord"
                >
                  <FaArrowLeft className="text-xl" />
                </Link>
                <h1 className="text-3xl md:text-4xl font-bold text-white">
                  <span className="bg-gradient-to-r from-purple-500 to-pink-600 bg-clip-text text-transparent">
                    Gestion des utilisateurs
                  </span>
                </h1>
              </div>
              <p className="text-gray-400">
                G√©rez les r√¥les et permissions des utilisateurs
              </p>
            </div>
            
            <div className="flex flex-wrap gap-3">
              <button
                onClick={loadUsers}
                className="px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white font-medium rounded-lg transition-all duration-200 flex items-center gap-2"
              >
                <FaSearch className={loading ? 'animate-spin' : ''} />
                {loading ? 'Chargement...' : 'Actualiser'}
              </button>
            </div>
          </div>

          {/* Statistiques */}
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
              <div className="text-3xl font-bold text-white mb-1">{users.length}</div>
              <div className="text-gray-400 text-sm">Total utilisateurs</div>
            </div>
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
              <div className="text-3xl font-bold text-purple-400 mb-1">
                {users.filter(u => u.isAdmin).length}
              </div>
              <div className="text-gray-400 text-sm">Administrateurs</div>
            </div>
            <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border border-slate-700">
              <div className="text-3xl font-bold text-cyan-400 mb-1">
                {users.filter(u => !u.isAdmin).length}
              </div>
              <div className="text-gray-400 text-sm">Utilisateurs standard</div>
            </div>
          </div>
        </header>

        {/* Barre de contr√¥le */}
        <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 mb-6 border border-slate-700">
          <div className="flex flex-col md:flex-row gap-4">
            {/* Barre de recherche */}
            <div className="flex-1 relative">
              <div className="absolute inset-y -0 left-0 pl-3 flex items-center pointer-events-none">
                <FaSearch className="text-gray-500" />
              </div>
              <input
                type="text"
                placeholder="Rechercher par email ou nom..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="w-full pl-10 pr-4 py-2 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              />
            </div>

            {/* Filtres */}
            <div className="flex gap-2">
              <button
                onClick={() => setFilterRole('all')}
                className={`px-4 py-2 rounded-lg ${filterRole === 'all' ? 'bg-gradient-to-r from-blue-600 to-cyan-600' : 'bg-slate-700 hover:bg-slate-600'}`}
              >
                Tous
              </button>
              <button
                onClick={() => setFilterRole('admin')}
                className={`px-4 py-2 rounded-lg ${filterRole === 'admin' ? 'bg-gradient-to-r from-purple-600 to-pink-600' : 'bg-slate-700 hover:bg-slate-600'}`}
              >
                <FaUserShield className="inline mr-2" /> Admins
              </button>
              <button
                onClick={() => setFilterRole('user')}
                className={`px-4 py-2 rounded-lg ${filterRole === 'user' ? 'bg-gradient-to-r from-cyan-600 to-blue-600' : 'bg-slate-700 hover:bg-slate-600'}`}
              >
                <FaUser className="inline mr-2" /> Utilisateurs
              </button>
            </div>
          </div>
        </div>

        {/* Tableau des utilisateurs */}
        <div className="bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700">
          {loading ? (
            <div className="p-12 text-center">
              <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500 mx-auto mb-4"></div>
              <h3 className="text-xl font-semibold text-white mb-2">Chargement des utilisateurs</h3>
              <p className="text-gray-400">Veuillez patienter...</p>
            </div>
          ) : filteredUsers.length === 0 ? (
            <div className="p-12 text-center">
              <div className="text-6xl mb-4">üë•</div>
              <h3 className="text-xl font-semibold text-white mb-2">Aucun utilisateur trouv√©</h3>
              <p className="text-gray-400">Modifiez vos crit√®res de recherche</p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-900/80">
                  <tr>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Utilisateur</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Email</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Date d'inscription</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">R√¥le</th>
                    <th className="py-4 px-4 text-left text-sm font-semibold text-gray-300">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {filteredUsers.map((user) => (
                    <tr 
                      key={user.uid} 
                      className={`border-b border-slate-700/50 hover:bg-slate-700/30 transition-all duration-150 ${
                        currentUser?.uid === user.uid ? 'bg-blue-900/20' : ''
                      }`}
                    >
                      <td className="py-4 px-4">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 flex items-center justify-center text-white font-bold">
                            {user.displayName?.charAt(0) || user.email?.charAt(0) || 'U'}
                          </div>
                          <div>
                            <div className="font-medium text-white">
                              {user.displayName || 'Non renseign√©'}
                              {currentUser?.uid === user.uid && (
                                <span className="ml-2 text-xs bg-blue-500 text-white px-2 py-1 rounded">VOUS</span>
                              )}
                            </div>
                            <div className="text-xs text-gray-400">UID: {user.uid.substring(0, 8)}...</div>
                          </div>
                        </div>
                      </td>
                      <td className="py-4 px-4">
                        <div className="flex items-center gap-2 text-gray-300">
                          <FaEnvelope className="text-gray-500" />
                          {user.email}
                        </div>
                      </td>
                      <td className="py-4 px-4">
                        <div className="flex items-center gap-2 text-gray-400">
                          <FaCalendarAlt className="text-gray-500" />
                          {formatDate(user.createdAt)}
                        </div>
                      </td>
                      <td className="py-4 px-4">
                        <div className={`px-3 py-1.5 rounded-full text-xs font-medium flex items-center gap-1.5 ${
                          user.isAdmin 
                            ? 'bg-gradient-to-r from-purple-900/30 to-pink-900/30 text-purple-400' 
                            : 'bg-gradient-to-r from-slate-700 to-slate-800 text-gray-400'
                        }`}>
                          {user.isAdmin ? <FaCrown /> : <FaUser />}
                          {user.isAdmin ? 'Administrateur' : 'Utilisateur'}
                        </div>
                      </td>
                      <td className="py-4 px-4">
                        <div className="flex gap-2">
                          {user.isAdmin ? (
                            <button
                              onClick={() => handleRemoveAdmin(user.uid, user.email || '')}
                              disabled={updatingUser === user.uid || currentUser?.uid === user.uid}
                              className={`px-3 py-1.5 bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 text-white text-sm font-medium rounded-lg transition-all duration-200 flex items-center gap-1.5 ${
                                currentUser?.uid === user.uid ? 'opacity-50 cursor-not-allowed' : 'hover:scale-105'
                              }`}
                              title={currentUser?.uid === user.uid ? "Vous ne pouvez pas vous retirer vos propres droits" : "Retirer les droits admin"}
                            >
                              {updatingUser === user.uid ? (
                                <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                              ) : (
                                <FaUserTimes />
                              )}
                              Retirer Admin
                            </button>
                          ) : (
                            <button
                              onClick={() => handleMakeAdmin(user.uid, user.email || '')}
                              disabled={updatingUser === user.uid}
                              className="px-3 py-1.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white text-sm font-medium rounded-lg transition-all duration-200 flex items-center gap-1.5 hover:scale-105"
                              title="Donner les droits administrateur"
                            >
                              {updatingUser === user.uid ? (
                                <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                              ) : (
                                <FaUserCheck />
                              )}
                              Rendre Admin
                            </button>
                          )}
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>

        {/* Informations */}
        <div className="mt-8 bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700">
          <h3 className="text-lg font-semibold text-white mb-3 flex items-center gap-2">
            <FaUserShield /> Guide des permissions
          </h3>
          <ul className="text-gray-400 space-y-2">
            <li className="flex items-start gap-2">
              <span className="text-purple-400 mt-1">‚Ä¢</span>
              <span><strong>Administrateurs</strong> peuvent g√©rer les articles et les utilisateurs</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-cyan-400 mt-1">‚Ä¢</span>
              <span><strong>Utilisateurs standards</strong> peuvent seulement lire les articles</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-yellow-400 mt-1">‚ö†</span>
              <span>Un administrateur ne peut pas se retirer ses propres droits (s√©curit√©)</span>
            </li>
            <li className="flex items-start gap-2">
              <span className="text-blue-400 mt-1">‚Ñπ</span>
              <span>Les modifications de r√¥le peuvent prendre quelques minutes pour √™tre effectives</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  );
} 
------------------------------------------- 
 
[FICHIER 12] \app\admin\[uid]\role\route.ts 
------------------------------------------- 
import { NextRequest, NextResponse } from 'next/server';

export async function POST(
  request: NextRequest,
  context: { params: Promise<{ uid: string }> }
) {
  try {
    const { uid } = await context.params;
    const { role } = await request.json();

    return NextResponse.json({
      success: true,
      uid,
      role,
      updatedAt: new Date().toISOString(),
    });
  } catch (error) {
    return NextResponse.json(
      { error: 'Erreur serveur' },
      { status: 500 }
    );
  }
}

export async function GET(
  request: NextRequest,
  context: { params: Promise<{ uid: string }> }
) {
  try {
    const { uid } = await context.params;

    return NextResponse.json({
      uid,
      role: 'user',
      isAdmin: false,
    });
  } catch {
    return NextResponse.json(
      { error: 'Erreur serveur' },
      { status: 500 }
    );
  }
}
 
------------------------------------------- 
 
[FICHIER 13] \app\api\admin\users\route.ts 
------------------------------------------- 
import { NextRequest, NextResponse } from 'next/server';
import { adminAuth } from '@/lib/firebase-admin';

/**
 * UID du super administrateur (chermad)
 * ‚ö†Ô∏è Ce compte est PROT√âG√â et ne peut jamais perdre son r√¥le admin
 */
const SUPER_ADMIN_UID = 'WvFyq3LOSKgx8KJSMUqAXA8EENQ2';

/**
 * V√©rifie que la requ√™te provient d'un utilisateur ADMIN
 * - Lit le token Bearer
 * - V√©rifie le custom claim "role"
 */
async function verifyAdmin(request: NextRequest) {
  const authHeader = request.headers.get('authorization');

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    throw new Error('Token manquant ou invalide');
  }

  const token = authHeader.replace('Bearer ', '');
  const decodedToken = await adminAuth.verifyIdToken(token);

  if (decodedToken.role !== 'admin') {
    throw new Error('Acc√®s refus√© : droits administrateur requis');
  }

  return decodedToken;
}

/**
 * GET /api/admin/users
 * ‚ûú Liste tous les utilisateurs Firebase Auth (r√©els)
 */
export async function GET(request: NextRequest) {
  try {
    await verifyAdmin(request);

    const listResult = await adminAuth.listUsers(1000);

    const users = listResult.users.map(user => ({
      uid: user.uid,
      email: user.email ?? null,
      displayName: user.displayName ?? null,
      photoURL: user.photoURL ?? null,
      isAdmin: user.customClaims?.role === 'admin',
      createdAt: user.metadata.creationTime ?? null,
      lastSignInAt: user.metadata.lastSignInTime ?? null,
    }));

    return NextResponse.json(users, { status: 200 });
  } catch (error: any) {
    console.error('GET /api/admin/users error:', error);

    return NextResponse.json(
      { error: error.message || 'Erreur serveur' },
      { status: 401 }
    );
  }
}

/**
 * POST /api/admin/users
 * ‚ûú Ajoute ou retire le r√¥le ADMIN √† un utilisateur
 *
 * Body attendu :
 * {
 *   "uid": "xxxxxxxx",
 *   "makeAdmin": true | false
 * }
 */
export async function POST(request: NextRequest) {
  try {
    await verifyAdmin(request);

    const body = await request.json();
    const { uid, makeAdmin } = body;

    if (!uid || typeof makeAdmin !== 'boolean') {
      return NextResponse.json(
        { error: 'Payload invalide' },
        { status: 400 }
      );
    }

    // üîê Protection ABSOLUE du super admin (chermad)
    if (uid === SUPER_ADMIN_UID) {
      return NextResponse.json(
        { error: 'Action interdite : le super administrateur est prot√©g√©' },
        { status: 403 }
      );
    }

    if (makeAdmin) {
      await adminAuth.setCustomUserClaims(uid, { role: 'admin' });
    } else {
      await adminAuth.setCustomUserClaims(uid, { role: 'user' });
    }

    return NextResponse.json({ success: true }, { status: 200 });
  } catch (error: any) {
    console.error('POST /api/admin/users error:', error);

    return NextResponse.json(
      { error: error.message || 'Erreur serveur' },
      { status: 401 }
    );
  }
}
 
------------------------------------------- 
 
[FICHIER 14] \app\posts\[slug]\page.tsx 
------------------------------------------- 
import { notFound } from 'next/navigation';
import Image from 'next/image'; 
import { getPostBySlug, Post } from '@/lib/firestore'; 

interface PostPageProps {
  // Les params sont d√©finis ici
  params: {
    slug: string;
  };
}

/**
 * Composant de page dynamique pour afficher un article sp√©cifique.
 * Le composant est 'async' pour pouvoir utiliser 'await'.
 */
export default async function PostPage({ params }: PostPageProps) {
    // CORRECTION CRITIQUE : Utilisation de 'await' pour s'assurer que les params
    // sont r√©solus correctement.
    const resolvedParams = await params;
    const slug = resolvedParams.slug;


  // V√âRIFICATION DE S√âCURIT√â : Assurer que le slug est d√©fini
  if (!slug) {
    notFound(); 
  }
  
  // Utilisation de 'await' pour r√©soudre la Promise de la BDD.
  const post: Post | null = await getPostBySlug(slug); 

  // Si le post n'est pas trouv√©
  if (!post) {
    notFound(); 
  }

  // Conversion du Timestamp (post.createdAt) en Date pour l'affichage.
  const displayDate = post.createdAt.toDate().toLocaleDateString('fr-FR');


  return (
    <div className="container mx-auto p-8 max-w-4xl bg-slate-800 shadow-2xl rounded-xl mt-10 text-white">
      <article className="space-y-6">
        <header className="border-b border-slate-700 pb-4 mb-6">
          <h1 className="text-4xl font-extrabold text-white mb-2">
            {post.title}
          </h1>
          <p className="text-sm text-gray-400">
            Publi√© le {displayDate} par <span className="text-indigo-400 font-medium">{post.author}</span>
          </p>
        </header>
        
        {/* -------------------- D√âBUT DU BLOC IMAGE (Correction Largeur et Hauteur) -------------------- */}
        {post.imageUrl && (
            // w-full pour 100% largeur. 
            // h-64 sur mobile, md:aspect-video sur desktop pour une hauteur limit√©e mais proportionnelle.
            // bg-slate-900 pour le fond tr√®s sombre derri√®re l'image non couverte.
            <div className="relative w-full h-64 md:aspect-video md:h-auto overflow-hidden rounded-lg shadow-xl mb-8 bg-slate-900">
                <Image
                    src={post.imageUrl}
                    alt={post.title} 
                    fill 
                    // NOUVEAU: 'object-contain' assure que l'image est enti√®rement visible 
                    // sans √™tre d√©form√©e, utilisant le bg-slate-900 pour remplir l'espace vide.
                    style={{ objectFit: 'contain' }} 
                    priority 
                    sizes="(max-width: 768px) 100vw, 800px"
                    className="transition-transform duration-500 hover:scale-105" 
                />
            </div>
        )}
        {/* -------------------- FIN DU BLOC IMAGE -------------------- */}

        {/* Affichage du contenu du post */}
        <div 
          // Utilisation de dangerouslySetInnerHTML pour injecter le contenu (potentiellement HTML/Markdown converti)
          className="prose prose-lg max-w-none text-gray-200 leading-relaxed"
          dangerouslySetInnerHTML={{ __html: post.content || post.description }} 
        />
        
        <div className="pt-6 border-t border-slate-700 mt-8">
            <a href="/" className="inline-block px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300">
                Retour √† l'accueil
            </a>
        </div>
      </article>
    </div>
  );
}

// Fonction de g√©n√©ration des m√©tadonn√©es
export async function generateMetadata({ 
    params,
}: PostPageProps) {
    // CORRECTION CRITIQUE : Utilisation de 'await' pour s'assurer que les params
    // sont r√©solus correctement.
    const resolvedParams = await params;
    const slug = resolvedParams.slug;
    
    // V√âRIFICATION DE S√âCURIT√â : Assurer que le slug est d√©fini avant l'appel DB
    if (!slug) {
        // Retourne un titre par d√©faut si le slug est manquant
        return { title: 'Article Non Trouv√©', description: 'Le param√®tre de slug est manquant.' };
    }
    
  // R√©cup√©ration des donn√©es pour les m√©tadonn√©es (doit √™tre await√©)
  const post: Post | null = await getPostBySlug(slug);

  if (!post) {
    return { title: 'Article Non Trouv√©', description: 'Le contenu de cet article est introuvable.' };
  }

  return {
    title: post.title,
    description: post.description || post.content.substring(0, 150) + '...',
  };
} 
------------------------------------------- 
 
 
=============================================== 
 
[DOSSIER: \components]                                 
=============================================== 
 
[FICHIER 15] \components\AdminPostsList.tsx 
------------------------------------------- 
'use client';

import { useState, useEffect, useCallback } from 'react';
import Link from 'next/link';
// Importez les fonctions n√©cessaires directement depuis votre fichier lib/firestore.js
import { Post, getAllPosts, deletePost } from '@/lib/firestore'; 

export default function AdminPostsList() {
    const [posts, setPosts] = useState<Post[]>([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);
    const [deletingId, setDeletingId] = useState<string | null>(null);

    // Fonction pour charger les donn√©es (utile pour le rechargement apr√®s suppression)
    const fetchPosts = useCallback(async () => {
        setLoading(true);
        setError(null);
        try {
            // L'appel √† getAllPosts() r√©cup√®re tous les articles
            const fetchedPosts = await getAllPosts(); 
            // Tri pour s'assurer que les articles sont affich√©s par date de cr√©ation, 
            // bien que getAllPosts le fasse d√©j√† dans l'impl√©mentation fournie.
            setPosts(fetchedPosts.sort((a, b) => b.createdAt.toDate().getTime() - a.createdAt.toDate().getTime()));
        } catch (err) {
            console.error("√âchec du chargement des articles pour l'admin :", err);
            setError("Impossible de charger les articles du blog.");
        } finally {
            setLoading(false);
        }
    }, []);

    useEffect(() => {
        fetchPosts();
    }, [fetchPosts]);

    const handleDelete = async (postId: string, title: string) => {
        // Confirmation avant la suppression
        if (window.confirm(`√ätes-vous s√ªr de vouloir supprimer l'article: "${title}" ? Cette action est irr√©versible.`)) {
            setDeletingId(postId);
            try {
                // Appel de la fonction deletePost impl√©ment√©e
                await deletePost(postId);
                // Recharger la liste apr√®s la suppression r√©ussie
                fetchPosts();
            } catch (err) {
                // Afficher l'erreur retourn√©e par la fonction deletePost
                alert("Erreur lors de la suppression de l'article. Veuillez r√©essayer.");
                console.error(err);
            } finally {
                setDeletingId(null);
            }
        }
    };

    if (loading) {
        return <div className="text-center py-10 text-gray-400">Chargement des articles...</div>;
    }

    if (error) {
        return <div className="text-center py-10 text-red-400">Erreur : {error}</div>;
    }

    if (posts.length === 0) {
        return <div className="text-center py-10 text-gray-500">Aucun article trouv√©.</div>;
    }

    return (
        <div className="overflow-x-auto shadow-2xl rounded-lg border border-slate-700">
            <table className="min-w-full divide-y divide-slate-700 bg-slate-800">
                <thead className="bg-slate-700">
                    <tr>
                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                            Titre
                        </th>
                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider hidden sm:table-cell">
                            Publi√©
                        </th>
                        <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                            Date
                        </th>
                        <th scope="col" className="px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">
                            Actions
                        </th>
                    </tr>
                </thead>
                <tbody className="divide-y divide-slate-700">
                    {posts.map((post) => (
                        <tr key={post.id} className="hover:bg-slate-700 transition duration-150">
                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">
                                <Link href={`/posts/${post.slug}`} className="hover:text-blue-400">
                                    {post.title}
                                </Link>
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-400 hidden sm:table-cell">
                                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                    post.isPublished ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                }`}>
                                    {post.isPublished ? 'Oui' : 'Non'}
                                </span>
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-400">
                                {post.createdAt.toDate().toLocaleDateString('fr-FR')}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-3">
                                {/* Bouton de Modification - Route /admin/edit/[id] √† cr√©er */}
                                <Link href={`/admin/edit/${post.id}`} 
                                    className="text-indigo-400 hover:text-indigo-600 transition duration-150 font-bold"
                                >
                                    Modifier
                                </Link>

                                {/* Bouton de Suppression */}
                                <button
                                    onClick={() => handleDelete(post.id, post.title)}
                                    className="text-red-400 hover:text-red-600 transition duration-150 font-bold disabled:opacity-50"
                                    disabled={deletingId === post.id}
                                >
                                    {deletingId === post.id ? '...' : 'Supprimer'}
                                </button>
                            </td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </div>
    );
} 
------------------------------------------- 
 
[FICHIER 16] \components\AllPosts.tsx 
------------------------------------------- 
import { getAllPosts } from "@/lib/firestore";
import PostCard from "./PostCard";

export default async function AllPosts() {
  const allPosts = await getAllPosts();
  
  // 1. Filtrer uniquement les articles publi√©s
  const publishedPosts = allPosts.filter(post => post.isPublished === true);
  
  // 2. Trier par date (du plus r√©cent au plus ancien)
  const sortedPosts = publishedPosts.sort((a, b) => 
    b.createdAt.toDate().getTime() - a.createdAt.toDate().getTime()
  );
  
  // 3. Exclure le dernier article (le plus r√©cent) pour ne pas le dupliquer
  // Le dernier article est d√©j√† affich√© s√©par√©ment dans LatestPost
  const posts = sortedPosts.length > 1 ? sortedPosts.slice(1) : sortedPosts;

  if (publishedPosts.length === 0) {
    return (
      <div className="text-center text-gray-500 py-10">
        Aucun article publi√© pour le moment.
      </div>
    );
  }

  if (posts.length === 0) {
    return (
      <div className="text-center text-gray-500 py-10">
        <p>Le dernier article est affich√© ci-dessus.</p>
        <p className="mt-2">Cr√©ez d'autres articles pour les voir appara√Ætre ici.</p>
      </div>
    );
  }

  return (
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-12">
      {posts.map(post => (
        <PostCard key={post.id} post={post} />
      ))}
    </div>
  );
} 
------------------------------------------- 
 
[FICHIER 17] \components\Footer.tsx 
------------------------------------------- 
// components/Footer.tsx
export default function Footer() {
  return (
    <footer className="bg-slate-900 border-t border-slate-700 py-6">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-500">
        <p>
          &copy; {new Date().getFullYear()} Mon Blog JS. Tous droits r√©serv√©s.
        </p>
        <p className="mt-1">
          Projet d'apprentissage Next.js et Firebase.
        </p>
      </div>
    </footer>
  );
} 
------------------------------------------- 
 
[FICHIER 18] \components\Header.tsx 
------------------------------------------- 
'use client';

import { useState, useEffect } from "react";
import Link from "next/link";
import { auth } from "@/lib/firebase"; // Importation de Firebase Auth
import { signOut, onAuthStateChanged, User } from "firebase/auth";
import LoginModal from "@/components/LoginModal";  // Importation de la modal de connexion

export default function Header() {
  const [user, setUser] = useState<User | null>(null); // Suivi de l'utilisateur connect√©
  const [isModalOpen, setIsModalOpen] = useState(false); // √âtat pour la modal
  const [avatar, setAvatar] = useState<string>("/default-avatar.png"); // Toujours initialiser avec l'avatar par d√©faut
  const [email, setEmail] = useState<string>("");
  const [isAdmin, setIsAdmin] = useState(false); // Nouvel √©tat pour v√©rifier si l'utilisateur est admin

  // Suivi de l'√©tat d'authentification
  useEffect(() => {
    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
      if (currentUser) {
        setUser(currentUser);
        setEmail(currentUser.email || ""); // Stocker l'email de l'utilisateur
        // V√©rifier que photoURL est valide avant de l'utiliser
        if (currentUser.photoURL && isValidUrl(currentUser.photoURL)) {
          setAvatar(currentUser.photoURL);
        } else {
          setAvatar("/default-avatar.png");
        }

        // V√©rifier si l'utilisateur est un admin
        currentUser.getIdTokenResult().then((idTokenResult) => {
          if (idTokenResult.claims.role === 'admin') {
            setIsAdmin(true);
          }
        }).catch((error) => {
          console.error("Erreur lors de la r√©cup√©ration des claims : ", error);
        });

      } else {
        setUser(null);
        setAvatar("/default-avatar.png");
        setEmail(""); // R√©initialiser l'email √† la d√©connexion
        setIsAdmin(false); // R√©initialiser l'√©tat d'admin
      }
    });
    return unsubscribe;
  }, []);

  // Fonction pour valider l'URL
  const isValidUrl = (urlString: string) => {
    try {
      const url = new URL(urlString);
      return url.protocol === "http:" || url.protocol === "https:";
    } catch (e) {
      return false;
    }
  };

  const handleLogout = async () => {
    try {
      await signOut(auth);
    } catch (error) {
      console.error("Erreur de d√©connexion:", error);
    }
  };

  const openModal = () => setIsModalOpen(true);
  const closeModal = () => setIsModalOpen(false);

  return (
    <header className="bg-slate-900 shadow-md border-b border-slate-700">
      <nav className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
        <Link href="/" className="text-3xl font-extrabold text-white hover:text-blue-400 transition duration-150">
          Mon Blog Moto
        </Link>
        <div className="space-x-4 flex items-center">
          <Link href="/" className="text-gray-300 hover:text-blue-400 font-medium transition duration-150">
            Accueil
          </Link>

          {/* Afficher le bouton "Admin" seulement si l'utilisateur est admin */}
          {isAdmin && (
            <Link href="/admin" className="text-blue-400 hover:text-blue-300 font-medium border border-blue-400 px-3 py-1 rounded-md transition duration-150">
              Admin
            </Link>
          )}
          
          {user ? (
            <div className="flex flex-col sm:flex-row items-center sm:space-x-3 space-y-3 sm:space-y-0">
              <img 
                src={avatar} 
                alt="Avatar" 
                className="w-8 h-8 rounded-full" 
                onError={(e) => {
                  // Simplement remplacer par l'avatar par d√©faut une seule fois
                  e.currentTarget.src = "/default-avatar.png";
                }}
              />
              <div className="text-white flex flex-col items-center sm:items-start">
                <span>{user.displayName || email}</span>
                {/* Afficher l'ic√¥ne üîë si l'utilisateur est un admin */}
                {isAdmin && (
                  <span className="text-yellow-500 ml-2">üîë</span>  // Ic√¥ne cl√© pour admin
                )}
              </div>

              <button
                onClick={handleLogout}
                className="text-gray-300 hover:text-blue-400 font-medium sm:px-4 px-2 py-1 rounded-md bg-blue-500 text-white w-full sm:w-auto"
              >
                D√©connexion
              </button>
            </div>
          ) : (
            <button
              onClick={openModal}
              className="text-gray-300 hover:text-blue-400 font-medium sm:px-4 px-2 py-1 rounded-md bg-blue-500 text-white w-full sm:w-auto"
            >
              Connexion
            </button>
          )}
        </div>
      </nav>

      {isModalOpen && <LoginModal closeModal={closeModal} />}
    </header>
  );
}
 
------------------------------------------- 
 
[FICHIER 19] \components\LatestPost.tsx 
------------------------------------------- 
// components/LatestPost.tsx

import { getAllPosts } from '@/lib/firestore'; // Utilisez getAllPosts au lieu de getLatestPost
import Link from 'next/link';
import Image from 'next/image'; 
import { Post } from '@/lib/firestore'; 

export default async function LatestPost() {
  const allPosts = await getAllPosts();
  
  // Filtrer uniquement les articles publi√©s
  const publishedPosts = allPosts.filter(post => post.isPublished === true);
  
  // Trier par date (du plus r√©cent au plus ancien) et prendre le premier
  const sortedPosts = publishedPosts.sort((a, b) => 
    b.createdAt.toDate().getTime() - a.createdAt.toDate().getTime()
  );
  
  const post = sortedPosts.length > 0 ? sortedPosts[0] : null;

  if (!post) {
    return (
      <div className="text-center text-gray-500 py-10">
        <p>Aucun article publi√© pour le moment.</p>
        <p className="mt-2 text-sm">Veuillez publier un article dans l'interface admin.</p> 
      </div>
    );
  }

  const dateStr = post.createdAt?.toDate().toLocaleDateString('fr-FR', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }) || 'Date inconnue';
  
  const postUrl = `/posts/${post.slug || post.id}`;

  return (
    <div className="max-w-4xl mx-auto p-8 bg-slate-800 rounded-xl shadow-2xl border border-slate-700 hover:border-blue-500 transition duration-300">
      
      {/* üåü CORRECTION : Utilisation de l'aspect-ratio pour une image 16:9 responsive */}
      {post.imageUrl && (
        <div className="mb-6 overflow-hidden rounded-lg">
          <div className="relative w-full aspect-video"> 
            <Image
              src={post.imageUrl}
              alt={post.title}
              fill
              className="object-cover" 
              sizes="(max-width: 1024px) 100vw, 768px"
              priority 
            />
          </div>
        </div>
      )}

      <h2 className="text-3xl font-bold mb-3 text-blue-400">
        {post.title}
      </h2>
      <p className="text-sm text-gray-500 mb-6">
        Publi√© le : {dateStr}
      </p>
      
      <div className="text-gray-300 leading-relaxed">
        <p>{post.description}</p>
      </div>

      <Link
        href={postUrl}
        className="mt-6 inline-block px-4 py-2 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-500 transition duration-300"
      >
        Lire l'article complet
      </Link>
    </div>
  );
} 
------------------------------------------- 
 
[FICHIER 20] \components\LoginModal.tsx 
------------------------------------------- 
'use client';

import { useState } from "react";
import { auth } from "@/lib/firebase"; // Importation de Firebase pour la gestion de l'authentification
import { GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "firebase/auth";

export default function LoginModal({ closeModal }: { closeModal: () => void }) {
  const [isLogin, setIsLogin] = useState(true);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");

  const handleGoogleLogin = async () => {
    const provider = new GoogleAuthProvider();
    try {
      await signInWithPopup(auth, provider);
      closeModal(); 
    } catch (err) {
      console.error("Erreur lors de la connexion avec Google : ", err);
    }
  };

  const handleEmailLogin = async () => {
    try {
      await signInWithEmailAndPassword(auth, email, password);
      closeModal(); 
    } catch (err) {
      setError("Erreur de connexion : V√©rifiez vos identifiants.");
    }
  };

  const handleEmailSignUp = async () => {
    try {
      await createUserWithEmailAndPassword(auth, email, password);
      closeModal(); 
    } catch (err) {
      setError("Erreur de cr√©ation de compte : Veuillez v√©rifier vos informations.");
    }
  };

  return (
    <div 
      className="fixed inset-0 flex justify-center items-center z-50" 
      style={{ backgroundColor: 'rgba(0, 0, 0, 0.5)' }} // Utilisation de rgba pour un fond semi-transparent
    >
      <div className="bg-white p-6 rounded-lg w-96 dark:bg-gray-800 dark:text-white">
        <h2 className="text-xl font-semibold text-center">{isLogin ? "Se connecter" : "Cr√©er un compte"}</h2>
        <form className="mt-4">
          <div>
            <label htmlFor="email" className="block text-sm">Email</label>
            <input
              type="email"
              id="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full p-2 border rounded mt-1 dark:bg-gray-700 dark:text-white"
              required
            />
          </div>
          <div className="mt-2">
            <label htmlFor="password" className="block text-sm">Mot de passe</label>
            <input
              type="password"
              id="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full p-2 border rounded mt-1 dark:bg-gray-700 dark:text-white"
              required
            />
          </div>
          {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
          <div className="mt-4">
            {isLogin ? (
              <button
                type="button"
                onClick={handleEmailLogin}
                className="w-full bg-blue-500 text-white py-2 rounded"
              >
                Connexion
              </button>
            ) : (
              <button
                type="button"
                onClick={handleEmailSignUp}
                className="w-full bg-green-500 text-white py-2 rounded"
              >
                Cr√©er un compte
              </button>
            )}
          </div>
        </form>

        <div className="flex justify-center mt-4">
          <button
            onClick={handleGoogleLogin}
            className="bg-red-500 text-white py-2 px-4 rounded"
          >
            Se connecter avec Google
          </button>
        </div>

        <div className="mt-4 text-center">
          <button
            onClick={() => setIsLogin(!isLogin)}
            className="text-blue-500 text-sm"
          >
            {isLogin ? "Cr√©er un compte ?" : "D√©j√† un compte ?"}
          </button>
        </div>

        <div className="mt-4 text-center">
          <button onClick={closeModal} className="text-gray-500 dark:text-gray-300">
            Fermer
          </button>
        </div>
      </div>
    </div>
  );
}
 
------------------------------------------- 
 
[FICHIER 21] \components\PostCard.tsx 
------------------------------------------- 
import Image from 'next/image';
import Link from 'next/link';
// Importez l'interface Post du fichier d'origine qui est TypeScript
import { Post } from '@/lib/firestore'; 

interface PostCardProps {
    post: Post;
}

/**
 * Composant pour afficher un r√©sum√© d'article sous forme de carte.
 * Il pr√©sente l'image √† gauche et les m√©tadonn√©es/description √† droite.
 */
export default function PostCard({ post }: PostCardProps) {
    const displayDate = post.createdAt.toDate().toLocaleDateString('fr-FR');
    const postUrl = `/posts/${post.slug}`;

    // Fonction pour tronquer la description √† un nombre de caract√®res (ex: 200)
    const truncateDescription = (text: string, limit: number) => {
        if (!text || text.length <= limit) {
            return text;
        }
        // Trouve le dernier espace avant la limite
        const trimmedText = text.substring(0, limit);
        return trimmedText.substring(0, Math.min(trimmedText.length, trimmedText.lastIndexOf(' '))) + '...';
    };

    const shortDescription = truncateDescription(post.description, 200);

    return (
        <div className="bg-slate-800 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden border border-slate-700">
            {/* Le lien englobe toute la zone cliquable */}
            <Link href={postUrl} className="flex flex-col md:flex-row h-full">
                
                {/* Conteneur pour l'Image et les M√©tadonn√©es (gauche/haut) */}
                <div className="relative w-full md:w-1/3 bg-slate-900 overflow-hidden flex flex-col">
                    {/* Image principale */}
                    <div className="relative w-full h-48 md:h-full">
                        {post.imageUrl ? (
                            <Image
                                src={post.imageUrl}
                                alt={post.title}
                                fill
                                style={{ objectFit: 'cover' }}
                                sizes="(max-width: 768px) 100vw, 33vw"
                                className="transition-transform duration-500 hover:scale-110"
                            />
                        ) : (
                            <div className="flex items-center justify-center w-full h-full text-gray-400 text-sm">
                                Pas d'image
                            </div>
                        )}
                    </div>
                    
                    {/* Auteur et Date (EN DESSOUS de l'image sur Mobile/Tablet, ou dans la colonne de gauche) */}
                    <div className="p-3 bg-slate-900 border-t border-slate-700 text-xs text-gray-400">
                        <p className="font-semibold text-white">Par : {post.author}</p>
                        <p>Publi√© le : {displayDate}</p>
                    </div>
                </div>

                {/* Contenu (Titre et Description Tronqu√©e) (droite/bas) */}
                <div className="p-4 md:w-2/3 flex flex-col justify-between">
                    <div>
                        <h2 className="text-2xl font-bold text-white mb-2 leading-tight hover:text-indigo-400 transition">
                            {post.title}
                        </h2>
                        
                        {/* Description Tronqu√©e */}
                        <p className="text-gray-300 text-base mt-2">
                            {shortDescription}
                        </p>
                    </div>

                    {/* Lien "Lire la suite" */}
                    <div className="mt-4">
                        <span className="inline-block px-4 py-2 text-indigo-400 border border-indigo-400 font-semibold rounded-lg hover:bg-indigo-400 hover:text-white transition duration-300">
                            Lire la suite ‚Üí
                        </span>
                    </div>
                </div>
            </Link>
        </div>
    );
} 
------------------------------------------- 
 
[FICHIER 22] \components\RichTextEditor.tsx 
------------------------------------------- 
"use client";

import { useEffect, useRef, useState } from "react";
import "quill/dist/quill.snow.css";

type RichTextEditorProps = {
  value: string;
  onChange: (html: string) => void;
  className?: string;
};

export default function RichTextEditor({
  value,
  onChange,
  className = "",
}: RichTextEditorProps) {
  const containerRef = useRef<HTMLDivElement | null>(null);
  const quillRef = useRef<any>(null);
  const [isQuillReady, setIsQuillReady] = useState(false);

  // Initialisation de Quill
  useEffect(() => {
    let isMounted = true;

    const initQuill = async () => {
      // Ne rien faire si pas mont√© ou d√©j√† initialis√©
      if (!isMounted || !containerRef.current || quillRef.current) return;

      try {
        // Import dynamique de Quill
        const Quill = (await import("quill")).default;

        if (!isMounted || !containerRef.current) return;

        // Cr√©er un conteneur sp√©cifique pour Quill
        const editorContainer = document.createElement("div");
        editorContainer.className = "quill-editor-container";
        containerRef.current.innerHTML = ""; // Nettoyer
        containerRef.current.appendChild(editorContainer);

        // Initialiser Quill
        quillRef.current = new Quill(editorContainer, {
          theme: "snow",
          placeholder: "√âcrivez le contenu de l'article ici...",
          modules: {
            toolbar: [
              [{ header: [1, 2, 3, false] }],
              ["bold", "italic", "underline", "strike"],
              [{ color: [] }, { background: [] }],
              [{ list: "ordered" }, { list: "bullet" }],
              ["link", "image", "clean"],
            ],
          },
        });

        // D√©finir le contenu initial
        if (value && quillRef.current) {
          quillRef.current.root.innerHTML = value;
        }

        // √âcouter les changements
        quillRef.current.on("text-change", () => {
          if (quillRef.current && isMounted) {
            const html = quillRef.current.root.innerHTML;
            onChange(html);
          }
        });

        setIsQuillReady(true);
      } catch (error) {
        console.error("Erreur d'initialisation de Quill:", error);
      }
    };

    initQuill();

    return () => {
      isMounted = false;
      if (quillRef.current) {
        try {
          quillRef.current.off("text-change");
        } catch (e) {
          // Ignorer les erreurs de nettoyage
        }
        quillRef.current = null;
      }
      setIsQuillReady(false);
    };
  }, []); // Une seule initialisation

  // Synchroniser la valeur externe avec Quill
  useEffect(() => {
    if (quillRef.current && isQuillReady && value !== undefined) {
      // Ne mettre √† jour que si le contenu est diff√©rent
      const currentContent = quillRef.current.root.innerHTML;
      if (currentContent !== value) {
        quillRef.current.root.innerHTML = value;
      }
    }
  }, [value, isQuillReady]);

  return (
    <div className={`min-h-[400px] ${className}`}>
      <div ref={containerRef} className="h-full" />
      
      {/* Indicateur de chargement */}
      {!isQuillReady && (
        <div className="flex items-center justify-center h-full bg-gray-50 rounded-lg border">
          <div className="text-center">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"></div>
            <p className="text-gray-500 text-sm">Chargement de l'√©diteur...</p>
          </div>
        </div>
      )}
    </div>
  );
} 
------------------------------------------- 
 
 
=============================================== 
 
[DOSSIER: \lib]                                 
=============================================== 
 
[FICHIER 23] \lib\firebase-admin.ts 
------------------------------------------- 
import * as admin from 'firebase-admin';

/**
 * Initialisation UNIQUE de Firebase Admin SDK
 * ‚ö†Ô∏è Doit TOUJOURS utiliser le vrai projet Firebase
 * (jamais de projet fictif, m√™me en d√©veloppement)
 */

function initializeFirebaseAdmin() {
  // √âvite toute double initialisation
  if (admin.apps.length > 0) {
    return admin.app();
  }

  try {
    // V√©rification des variables d‚Äôenvironnement obligatoires
    const requiredEnvVars = [
      'FIREBASE_ADMIN_PROJECT_ID',
      'FIREBASE_ADMIN_CLIENT_EMAIL',
      'FIREBASE_ADMIN_PRIVATE_KEY',
    ];

    const missingVars = requiredEnvVars.filter(
      (key) => !process.env[key]
    );

    if (missingVars.length > 0) {
      throw new Error(
        `Variables d‚Äôenvironnement Firebase Admin manquantes : ${missingVars.join(', ')}`
      );
    }

    // Cr√©ation des credentials Firebase Admin
    const serviceAccount: admin.ServiceAccount = {
      projectId: process.env.FIREBASE_ADMIN_PROJECT_ID,
      clientEmail: process.env.FIREBASE_ADMIN_CLIENT_EMAIL,
      privateKey: process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g, '\n'),
    };

    // Initialisation Firebase Admin
    const app = admin.initializeApp({
      credential: admin.credential.cert(serviceAccount),
    });

    console.log('‚úÖ Firebase Admin SDK initialis√© avec succ√®s');
    console.log('üìå Project ID :', serviceAccount.projectId);

    return app;
  } catch (error) {
    console.error('‚ùå ERREUR CRITIQUE : Firebase Admin SDK non initialis√©');
    console.error(error);
    throw error; // ‚ùó On √©choue volontairement si Admin est mal configur√©
  }
}

// Initialisation r√©elle
const firebaseAdminApp = initializeFirebaseAdmin();

// Exports propres
export const adminAuth = admin.auth(firebaseAdminApp);
export const adminFirestore = admin.firestore(firebaseAdminApp);
export { admin };
 
------------------------------------------- 
 
[FICHIER 24] \lib\firebase.js 
------------------------------------------- 
import { initializeApp } from "firebase/app";
import { getFirestore, Timestamp } from "firebase/firestore";
import { getAuth } from "firebase/auth"; // Import de Firebase Auth

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

const app = initializeApp(firebaseConfig);

const db = getFirestore(app);
const auth = getAuth(app); // Initialisation de l'authentification Firebase

export { db, Timestamp, auth };  // Exportation de auth pour l'utiliser ailleurs dans l'app
 
------------------------------------------- 
 
[FICHIER 25] \lib\firestore-admin.ts 
------------------------------------------- 
// lib/firestore-admin.ts
// Fichier pour les op√©rations d'administration (cr√©ation, modification, suppression)

import { db } from '@/lib/firebase'; // Correction: supprimez le 'Post' de cet import
import {
  collection,
  doc,
  deleteDoc, // Correction: deleteDoc (pas deleteor--)
  updateDoc,
  addDoc,
  getDoc,
  serverTimestamp
} from 'firebase/firestore';
import { Post } from '@/lib/firestore'; // Correction: importez Post depuis firestore.ts

// Supprimer un article
export async function deletePost(postId: string): Promise<boolean> {
  try {
    const postRef = doc(db, 'Blog', postId);
    await deleteDoc(postRef);
    return true;
  } catch (error) {
    console.error('Erreur lors de la suppression:', error);
    return false;
  }
}

// Mettre √† jour un article
export async function updatePost(postId: string, data: Partial<Post>): Promise<boolean> {
  try {
    const postRef = doc(db, 'Blog', postId);
    await updateDoc(postRef, {
      ...data,
      updatedAt: serverTimestamp()
    });
    return true;
  } catch (error) {
    console.error('Erreur lors de la mise √† jour:', error);
    return false;
  }
}

// Cr√©er un nouvel article
export async function createPost(data: Omit<Post, 'id' | 'createdAt'>): Promise<string | null> {
  try {
    const blogCollectionRef = collection(db, 'Blog');
    const docRef = await addDoc(blogCollectionRef, {
      ...data,
      createdAt: serverTimestamp(),
      updatedAt: serverTimestamp()
    });
    return docRef.id;
  } catch (error) {
    console.error('Erreur lors de la cr√©ation:', error);
    return null;
  }
}

// Obtenir un article par ID (pour l'√©dition)
export async function getPostById(postId: string): Promise<Post | null> {
  try {
    const postRef = doc(db, 'Blog', postId);
    const docSnap = await getDoc(postRef);
    
    if (docSnap.exists()) {
      const data = docSnap.data();
      return {
        id: docSnap.id,
        author: data.author || '',
        content: data.content || '',
        createdAt: data.createdAt || serverTimestamp(),
        description: data.description || '',
        imageUrl: data.imageUrl || '',
        isPublished: data.isPublished || false,
        slug: data.slug || '',
        tags: data.tags || [],
        title: data.title || '',
      } as Post;
    } else {
      return null;
    }
  } catch (error) {
    console.error('Erreur lors de la r√©cup√©ration:', error);
    return null;
  }
} 
------------------------------------------- 
 
[FICHIER 26] \lib\firestore.ts 
------------------------------------------- 
import { db, Timestamp } from './firebase';
import { collection, query, orderBy, limit, getDocs, where, addDoc, doc, updateDoc, deleteDoc } from 'firebase/firestore';

// D√©finition de l'interface pour un Article de Blog (bas√©e sur votre structure Firestore)
export interface Post {
  id: string;
  title: string;
  slug: string;
  content: string; // Contenu complet de l'article
  createdAt: Timestamp; // Le type Timestamp de Firebase
  author: string;
  description: string;
  imageUrl: string;
  isPublished: boolean;
  tags: string[];
}

/**
 * R√©cup√®re le dernier article du blog depuis la collection 'Blog' de Firestore.
 * Cette fonction est appel√©e c√¥t√© serveur (dans un Server Component).
 * @returns Le dernier article (Post) ou null.
 */
export async function getLatestPost(): Promise<Post | null> {
  try {
    const blogCollectionRef = collection(db, 'Blog'); 

    // Requ√™te: trier par 'createdAt' (descendant) et limiter √† 1
    const q = query(
      blogCollectionRef,
      orderBy('createdAt', 'desc'),
      limit(1)
    );

    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      const doc = querySnapshot.docs[0];
      const data = doc.data();

      return { 
        id: doc.id, 
        author: data.author,
        content: data.content,
        createdAt: data.createdAt,
        description: data.description,
        imageUrl: data.imageUrl,
        isPublished: data.isPublished,
        slug: data.slug,
        tags: data.tags,
        title: data.title,
      } as Post;
    } else {
      return null; // Aucun article trouv√©
    }
  } catch (error) {
    console.error("Erreur lors de la r√©cup√©ration du dernier article:", error);
    return null; 
  }
}

/**
 * R√©cup√®re un article par son slug.
 * @param slug Le slug de l'article √† rechercher.
 * @returns L'article (Post) ou null.
 */
export async function getPostBySlug(slug: string): Promise<Post | null> {
  try {
    const blogCollectionRef = collection(db, 'Blog'); 

    // Requ√™te: filtrer par le champ 'slug' √©gal au slug fourni
    const q = query(
      blogCollectionRef,
      where('slug', '==', slug), // Filtrer par slug
      limit(1)
    );

    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      const doc = querySnapshot.docs[0];
      const data = doc.data();

      return { 
        id: doc.id, 
        author: data.author,
        content: data.content,
        createdAt: data.createdAt,
        description: data.description,
        imageUrl: data.imageUrl,
        isPublished: data.isPublished,
        slug: data.slug,
        tags: data.tags,
        title: data.title,
      } as Post;
    } else {
      return null; // Aucun article trouv√©
    }
  } catch (error) {
    console.error(`Erreur lors de la r√©cup√©ration de l'article avec slug ${slug}:`, error);
    return null; 
  }
}

/**
 * R√©cup√®re tous les articles du blog depuis la collection 'Blog' de Firestore.
 * @returns La liste des articles (Post[]).
 */
export async function getAllPosts(): Promise<Post[]> {
  try {
    const blogCollectionRef = collection(db, 'Blog');

    const q = query(
      blogCollectionRef,
      orderBy('createdAt', 'desc') // du plus r√©cent au plus ancien
    );

    const snapshot = await getDocs(q);

    return snapshot.docs.map(doc => ({
      id: doc.id,
      ...(doc.data() as Omit<Post, "id">),
    }));
  } catch (error) {
    console.error("Erreur getAllPosts:", error);
    return [];
  }
}

/**
 * Supprime un article de la collection 'Blog' en utilisant son ID.
 * @param postId L'ID de l'article √† supprimer.
 */
export async function deletePost(postId: string): Promise<void> {
  try {
    const postRef = doc(db, 'Blog', postId);
    await deleteDoc(postRef);
    console.log(`Article ${postId} supprim√© avec succ√®s.`);
  } catch (error) {
    console.error(`Erreur lors de la suppression de l'article ${postId}:`, error);
    throw new Error("La suppression a √©chou√©.");
  }
}

/**
 * Met √† jour un article existant dans la collection 'Blog'.
 * @param postId L'ID de l'article √† mettre √† jour.
 * @param updatedPost Les nouvelles donn√©es de l'article √† enregistrer.
 */
export async function updatePost(postId: string, updatedPost: Omit<Post, 'id'>): Promise<void> {
  try {
    const postRef = doc(db, 'Blog', postId);
    await updateDoc(postRef, updatedPost);
    console.log(`Article ${postId} mis √† jour avec succ√®s.`);
  } catch (error) {
    console.error(`Erreur lors de la mise √† jour de l'article ${postId}:`, error);
    throw new Error("La mise √† jour a √©chou√©.");
  }
}

/**
 * Ajoute un nouveau article dans la collection 'Blog'.
 * @param newPost Les donn√©es du nouvel article √† ajouter.
 * @returns L'ID du nouvel article ajout√©.
 */
export async function addNewPost(newPost: Omit<Post, 'id'>): Promise<string> {
  try {
    const blogCollectionRef = collection(db, 'Blog');

    // Ajout d'un nouveau document dans Firestore
    const docRef = await addDoc(blogCollectionRef, {
      ...newPost,
      createdAt: Timestamp.now(), // Ajouter la date de cr√©ation
    });

    console.log(`Article ajout√© avec succ√®s : ${docRef.id}`);
    return docRef.id;
  } catch (error) {
    console.error("Erreur lors de l'ajout du nouvel article:", error);
    throw new Error("L'ajout a √©chou√©.");
  }
}
 
------------------------------------------- 
 
[FICHIER 27] \lib\supabaseClient.ts 
------------------------------------------- 
 
------------------------------------------- 
 
[FICHIER 28] \lib\temp.js 
------------------------------------------- 
// Script pour nettoyer le cache Firebase Auth local (IndexedDB)
const { indexedDB } = require("fake-indexeddb");

// Firebase utilise la base IndexedDB suivante :
indexedDB.deleteDatabase("firebaseLocalStorageDb");

console.log("üî• Firebase Auth local reset !");
 
------------------------------------------- 
 
[FICHIER 29] \lib\user-management.ts 
------------------------------------------- 
import { auth } from './firebase';

/**
 * Structure utilis√©e par l‚ÄôUI /admin/users
 */
export interface UserWithRole {
  uid: string;
  email: string | null;
  displayName: string | null;
  photoURL: string | null;
  isAdmin: boolean;
  createdAt: string | null;
  lastSignInAt: string | null;
}

/**
 * R√©cup√®re le token Firebase de l‚Äôutilisateur courant
 */
async function getIdToken(): Promise<string> {
  const currentUser = auth.currentUser;

  if (!currentUser) {
    throw new Error('Utilisateur non authentifi√©');
  }

  return await currentUser.getIdToken();
}

/**
 * üîπ GET ‚Äî R√©cup√©rer tous les utilisateurs Firebase (r√©els)
 */
export async function getAllUsers(): Promise<UserWithRole[]> {
  try {
    const token = await getIdToken();

    const response = await fetch('/api/admin/users', {
      method: 'GET',
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    if (!response.ok) {
      const text = await response.text();
      console.error('API error response:', text);
      throw new Error('Erreur API /api/admin/users');
    }


    return await response.json();
  } catch (error) {
    console.error('getAllUsers error:', error);
    return [];
  }
}

/**
 * üîπ POST ‚Äî Donner le r√¥le ADMIN √† un utilisateur
 */
export async function setUserAdminRole(uid: string): Promise<boolean> {
  try {
    const token = await getIdToken();

    const response = await fetch('/api/admin/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({
        uid,
        makeAdmin: true,
      }),
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error || 'Impossible de donner le r√¥le admin');
    }

    return true;
  } catch (error) {
    console.error('setUserAdminRole error:', error);
    alert('Erreur lors de l‚Äôattribution du r√¥le admin');
    return false;
  }
}

/**
 * üîπ POST ‚Äî Retirer le r√¥le ADMIN √† un utilisateur
 */
export async function removeUserAdminRole(uid: string): Promise<boolean> {
  try {
    const token = await getIdToken();

    const response = await fetch('/api/admin/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({
        uid,
        makeAdmin: false,
      }),
    });

    if (!response.ok) {
  const error = await response.json();

  // Cas sp√©cifique : super admin prot√©g√©
  if (error.error === 'Action interdite : le super administrateur est prot√©g√©') {
    alert(
      '‚õî Ce compte est un super administrateur.\n' +
      'Ses droits ne peuvent pas √™tre retir√©s.'
    );
    return false;
  }

  throw new Error(error.error || 'Impossible de retirer le r√¥le admin');
}


    return true;
  } catch (error) {
    console.error('removeUserAdminRole error:', error);
    alert('Erreur lors du retrait du r√¥le admin');
    return false;
  }
}

/**
 * üîπ (Optionnel) R√©cup√©rer un utilisateur par UID
 */
export async function getUserById(uid: string): Promise<UserWithRole | null> {
  try {
    const users = await getAllUsers();
    return users.find(user => user.uid === uid) || null;
  } catch {
    return null;
  }
}

/**
 * üîπ (Optionnel) Recherche locale (d√©j√† utilis√©e par l‚ÄôUI)
 */
export async function searchUsers(query: string): Promise<UserWithRole[]> {
  const users = await getAllUsers();
  const q = query.toLowerCase();

  return users.filter(user =>
    user.email?.toLowerCase().includes(q) ||
    user.displayName?.toLowerCase().includes(q) ||
    user.uid.toLowerCase().includes(q)
  );
}
 
------------------------------------------- 
 
 
=============================================== 
 
[SECTION 3] FICHIER .ENV.LOCAL (STRUCTURE
======================================================= 
 
[FICHIER 30] \.env.local             
************************************************ 
NOTA: Les valeurs sensibles sont masquees           
************************************************ 
 
# =***VALUE_MASQUEE***        
# FIREBASE CLIENT (PUBLIC - FRONTEND)=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
NEXT_PUBLIC_FIREBASE_API_KEY=***VALUE_MASQUEE***        
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=***VALUE_MASQUEE***        
NEXT_PUBLIC_FIREBASE_PROJECT_ID=***VALUE_MASQUEE***        
NEXT_PUBLIC_FIREBASE_MESSAGAGE_SENDER_ID=***VALUE_MASQUEE***        
NEXT_PUBLIC_FIREBASE_APP_ID=***VALUE_MASQUEE***        
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
# FIREBASE ADMIN SDK (SERVER ONLY)=***VALUE_MASQUEE***        
# ‚ö†Ô∏è NE JAMAIS METTRE NEXT_PUBLIC_=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
FIREBASE_ADMIN_PROJECT_ID=***VALUE_MASQUEE***        
FIREBASE_ADMIN_CLIENT_EMAIL=***VALUE_MASQUEE***        
FIREBASE_ADMIN_PRIVATE_KEY=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
# SUPABASE (STORAGE)=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
NEXT_PUBLIC_SUPABASE_URL=***VALUE_MASQUEE***        
NEXT_PUBLIC_SUPABASE_ANON_KEY=***VALUE_MASQUEE***        
SUPABASE_SERVICE_ROLE_KEY=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
# NEXTAUTH (si utilis√© plus tard)=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
NEXTAUTH_URL=***VALUE_MASQUEE***        
NEXTAUTH_SECRET=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
# APP=***VALUE_MASQUEE***        
# =***VALUE_MASQUEE***        
NEXT_PUBLIC_APP_URL=***VALUE_MASQUEE***        
 
************************************************ 
 
 
======================================================= 
RESUM√â FINAL                                            
======================================================= 
 
Nombre total de fichiers: 30             
Dossiers inclus: app, components, lib                  
Date de generation: 31/12/2025 18:13:34,99                        
======================================================= 
FIN DU BUNDLE                                          
======================================================= 
